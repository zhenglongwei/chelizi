<!-- 定损历史记录 -->
<custom-nav-bar title="定损历史" showBack="{{true}}" />
<view class="page-root history-page" style="{{pageRootStyle}}">
  

  <block wx:if="{{!hasToken}}">
    <view class="history-empty card">
      <text class="text-muted fs-body">请先登录后查看历史记录</text>
      <navigator class="history-login-link" url="/pages/auth/login/index?redirect=%2Fpages%2Fdamage%2Fhistory%2Findex">去登录</navigator>
    </view>
  </block>
  <block wx:elif="{{hasToken && loading && list.length === 0}}">
    <view class="history-loading">
      <text class="text-muted fs-body">加载中...</text>
    </view>
  </block>
  <block wx:elif="{{hasToken && list.length === 0}}">
    <view class="history-empty card">
      <text class="text-muted fs-body">暂无定损记录</text>
      <navigator class="history-link" url="/pages/damage/upload/index">去定损</navigator>
    </view>
  </block>
  <block wx:elif="{{hasToken && list.length > 0}}">
    <scroll-view class="history-scroll" scroll-y style="{{scrollStyle}}" bindscrolltolower="onLoadMore">
      <view class="history-item card" wx:for="{{list}}" wx:key="report_id" data-id="{{item.report_id}}" bindtap="onItemTap">
        <view class="history-item-header">
          <text class="fs-body fw-bold">{{item.vehicle_info.plate_number || item.vehicle_info.model || '车辆'}}</text>
          <text class="text-muted fs-sm">{{item.created_at}}</text>
        </view>
        <view class="history-item-body" wx:if="{{item.total_estimate && item.total_estimate.length >= 2}}">
          <view class="history-item-row">
            <text class="text-muted fs-sm">预估费用：</text>
            <text class="fs-body">{{item.total_estimate[0]}}-{{item.total_estimate[1]}} 元</text>
          </view>
        </view>
        <view class="history-item-images" wx:if="{{item.images && item.images.length}}">
          <image class="history-thumb" wx:for="{{item.images}}" wx:for-item="img" wx:key="*this" src="{{img}}" mode="aspectFill"/>
        </view>
      </view>
      <view class="history-load-more" wx:if="{{hasMore && !loading}}">
        <text class="text-muted fs-sm">上拉加载更多</text>
      </view>
      <view class="history-bottom-pad"></view>
    </scroll-view>
  </block>
</view>
