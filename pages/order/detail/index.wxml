<!-- 订单详情 -->
<custom-nav-bar title="订单详情" showBack="{{true}}" />
<view class="page-root order-detail-page" style="{{pageRootStyle}}">
  <block wx:if="{{loading}}">
    <view class="order-loading"><text class="text-muted fs-body">加载中...</text></view>
  </block>
  <block wx:elif="{{order}}">
    <view class="order-detail card">
      <view class="order-detail-row">
        <text class="text-muted fs-sm">订单号</text>
        <text class="fs-body">{{order.order_id}}</text>
      </view>
      <view class="order-detail-row">
        <text class="text-muted fs-sm">维修厂</text>
        <text class="fs-body">{{order.shop_name || '-'}}</text>
      </view>
      <view class="order-detail-row">
        <text class="text-muted fs-sm">报价金额</text>
        <text class="fs-body text-gold">¥{{order.quoted_amount}}</text>
      </view>
      <view class="order-detail-row">
        <text class="text-muted fs-sm">订单状态</text>
        <text class="fs-body">{{order.statusText}}</text>
      </view>
      <view class="order-detail-row" wx:if="{{order.address}}">
        <text class="text-muted fs-sm">地址</text>
        <text class="fs-sm">{{order.address}}</text>
      </view>
      <view class="order-reward-preview card" wx:if="{{rewardPreview && (order.canConfirm || order.canReview || order.canFollowup)}}">
        <view class="order-reward-title fs-body fw-bold">奖励金预估</view>
        <view class="order-reward-total">
          <text class="text-muted fs-sm">可获奖励金</text>
          <text class="fs-body text-gold fw-bold">¥{{rewardPreview.total_reward}}</text>
        </view>
        <view class="order-reward-stages" wx:if="{{rewardPreview.stages && rewardPreview.stages.length}}">
          <text class="text-weak fs-sm" wx:for="{{rewardPreview.stages}}" wx:key="stage">{{item.stage === 'main' ? '主评价' : item.stage === '1m' ? '1个月追评' : '3个月追评'}} {{item.percent}}%</text>
        </view>
      </view>
      <view class="order-detail-actions">
        <button class="btn-secondary" bindtap="onCallShop" wx:if="{{order.shop_phone}}">联系维修厂</button>
        <button class="btn-primary" wx:if="{{order.canConfirm}}" bindtap="onConfirm">确认完成</button>
        <button class="btn-primary" wx:if="{{order.canReview}}" bindtap="onReview">去评价</button>
        <button class="btn-primary" wx:if="{{order.canFollowup}}" bindtap="onFollowup">去追评</button>
        <button class="btn-secondary order-cancel-btn" wx:if="{{order.canCancel}}" bindtap="onCancel">撤销订单</button>
      </view>
    </view>
  </block>
</view>
