# 车厘子小程序 - 开发说明

## 项目概述

车厘子是一款事故车维修竞价平台小程序，基于微信小程序原生框架开发，后端服务部署在阿里云ECS上。

## 项目结构

```
chelizi/
├── app.js                    # 小程序入口
├── app.json                  # 全局配置
├── app.wxss                  # 全局样式
├── utils/                    # 工具库
│   ├── logger.js            # 日志工具
│   ├── ui.js                # UI交互工具
│   ├── util.js              # 通用工具函数
│   ├── navigation.js        # 页面导航
│   └── api.js               # API请求封装
├── pages/                    # 页面目录
│   ├── index/               # 首页
│   ├── damage/upload/       # AI定损页
│   ├── bidding/detail/      # 竞价报价页
│   ├── shop/detail/         # 维修厂详情
│   ├── review/submit/       # 评价页
│   ├── user/index/          # 个人中心
│   └── logs/                # 日志页（模板自带）
├── web/                      # 后端服务
│   ├── .env                 # 环境变量
│   ├── api-server/          # API服务
│   │   ├── server.js        # 服务入口
│   │   └── package.json
│   ├── database/            # 数据库
│   │   └── schema.sql       # 表结构
│   └── README.md
└── *.md                      # 文档文件
```

## 已完成功能

### 1. 需求文档修正 ✅
- 将所有"微信云开发"改为"阿里云服务"
- 更新技术栈说明
- 更新API接口列表

### 2. 后端API服务 ✅
- Express框架搭建
- MySQL数据库连接
- JWT认证中间件
- 完整的业务API接口：
  - 用户认证（微信登录）
  - 用户管理
  - 定损分析
  - 竞价报价
  - 维修厂
  - 评价系统
  - 上传接口

### 3. 数据库设计 ✅
- 10张核心表：
  - users（用户）
  - shops（维修厂）
  - damage_reports（定损报告）
  - biddings（竞价）
  - quotes（报价）
  - orders（订单）
  - reviews（评价）
  - transactions（交易）
  - withdrawals（提现）
  - settings（配置）

### 4. 小程序框架页面 ✅
- 首页（AI定损入口、附近维修厂）
- AI定损页（照片上传、车辆信息）
- 竞价报价页（报价列表、选择维修厂）
- 维修厂详情页（信息、评价）
- 评价页（质量评价、返点）
- 个人中心页（钱包、订单、设置）

### 5. 公共工具库 ✅
- logger.js - 统一日志格式
- ui.js - 统一交互（加载、提示、弹窗）
- util.js - 数据格式化、通用函数
- navigation.js - 页面导航封装
- api.js - HTTP请求封装、业务API

## 技术规范

### 颜色规范
| 名称 | 色值 | 用途 |
|------|------|------|
| 主色 | #2B579A | 按钮、重要文字 |
| 次色 | #5B9BD5 | 辅助按钮、链接 |
| 强调色 | #70AD47 | 成功状态、返点 |
| 背景灰 | #F5F5F5 | 页面背景 |

### 字体规范
- H1: 20px Bold - 页面标题
- H2: 18px Bold - 卡片标题
- Body: 14px - 正文内容
- Caption: 12px - 辅助说明

### 缓存规范
- 用户信息：`wx.getStorageSync('userInfo')`
- Token：`wx.getStorageSync('token')`
- **禁止使用 app.globalData.userInfo**

## 开发流程

### 1. 配置环境
```bash
# 后端服务
cd web/api-server
npm install

# 配置.env文件
cp ../.env.example ../.env
# 编辑.env，填入实际配置
```

### 2. 初始化数据库
```bash
mysql -u root -p < web/database/schema.sql
```

### 3. 启动后端服务
```bash
npm run dev
```

### 4. 运行小程序
- 使用微信开发者工具打开项目
- 修改 appid 为实际小程序id
- 开启"不校验合法域名"（开发环境）
- API 地址：`config.js` 中 `BASE_URL` 已指向 `https://simplewin.cn`，与 web 后台共用同一 api-server

## 待开发功能

### 高优先级
1. [ ] 图片上传（OSS直传）
2. [ ] AI定损分析（调用阿里云AI）
3. [ ] 微信支付（提现、佣金）
4. [ ] 消息推送（报价通知、订单状态）
5. [ ] 地图导航（维修厂位置）

### 中优先级
1. [ ] 搜索功能
2. [ ] 筛选排序
3. [ ] 评价点赞
4. [ ] 分享功能
5. [ ] 数据统计

### 低优先级
1. [ ] 深色模式
2. [ ] 多语言
3. [ ] 客服系统

## 注意事项

1. **所有API请求必须通过 api.js 封装**
2. **所有日志必须使用 logger.js**
3. **所有交互必须使用 ui.js**
4. **页面跳转必须使用 navigation.js**
5. **时间/金额格式化必须使用 util.js**

## 协作规范

详见 `规范/协作规范.md`，核心要点：
- 优先参考 .html 文件布局
- 样式遵循《UI设计文档.md》
- 最小可用闭环原则
- 第一次开发不做兼容

## 联系方式

如有问题，请参考：
- 需求文档：`车厘子需求文档.md`
- UI设计：`UI设计文档.md`
- 后端文档：`web/README.md`
