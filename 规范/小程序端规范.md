# 小程序端规范

## 1. 日志统一

- 所有页面/组件必须使用 `miniprogram/utils/logger.js` 的 `Logger` 类进行日志记录，格式为 `[模块名] [级别] 消息`，不得直接使用 `console.log/error/warn`。

## 2. 用户交互统一

- 所有用户交互（弹窗、提示、加载等）必须使用 `miniprogram/utils/ui.js` 的统一方法：
  - `ui.showLoading(title, mask)` - 显示加载提示
  - `ui.hideLoading()` - 隐藏加载提示
  - `ui.showSuccess(title, duration)` - 显示成功提示
  - `ui.showError(title, duration)` - 显示错误提示
  - `ui.showWarning(title, duration)` - 显示警告提示
  - `ui.showConfirm(options)` - 显示确认对话框


## 3. 数据格式化统一

- 时间、金额等数据格式化必须使用 `miniprogram/utils/util.js` 中的统一方法：
  - `util.formatDateTime(date)` - 格式化日期时间（YYYY-MM-DD HH:mm:ss）
  - `util.formatDate(date)` - 格式化日期（YYYY-MM-DD）
  - `util.formatRelativeTime(date)` - 格式化相对时间（刚刚、5分钟前等）
  - `util.formatAmount(amount, showUnit)` - 格式化金额（保留两位小数）
  - 不得在各页面中重复实现格式化逻辑。

## 4. 错误处理统一

- 所有异步操作必须使用 `try-catch` 进行错误捕获，错误信息通过 `ui.showError` 统一显示给用户，错误日志通过 `Logger` 统一记录。

## 5. 页面跳转统一

- 页面跳转必须使用 `miniprogram/utils/navigation.js` 的统一方法：
  - `navigation.navigateTo(url, params)` - 跳转到指定页面（带参数）
  - `navigation.redirectTo(url, params)` - 重定向到指定页面（带参数）
  - `navigation.navigateBack(delta)` - 返回上一页
  - `navigation.switchTab(url, params)` - 切换到 Tab 页面（带参数）
  - 参数必须使用对象形式传递，避免直接拼接 URL。

## 6. 缓存管理统一

- **用户数据存储**：整个小程序的用户信息统一缓存在 `userInfo` key 下，使用 `wx.getStorageSync('userInfo')` 和 `wx.setStorageSync('userInfo', userInfo)` 进行读写。**禁止使用 `app.globalData.userInfo`**。
- **其他缓存**：其他缓存项（如 `accident_upload_cache`、`currentMerchantId` 等）同样直接使用字符串 key 存储，命名时应当符合字段的意义。

## 7. 模块化设计原则

## 8. 订单状态变化规则

### 9. 基本原则

- **不得删除订单**：任何时候都不允许删除订单；订单从创建到结束（完成或失效）的所有变动在数据库中可查。