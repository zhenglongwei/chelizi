# 服务商端开发计划

依据《协作规范.md》《车厘子-全流程需求梳理.md》，阶段二为服务商端闭环。

## 开发顺序（5.2 节）

| 顺序 | 页面/功能 | 路径 | 状态 |
|------|-----------|------|------|
| 1 | 服务商登录 | /pages/merchant/login | ✅ 已有 |
| 2 | 服务商注册 | /pages/merchant/register | ✅ 已有 |
| 3 | 竞价邀请列表 | /pages/merchant/bidding/list/index | ✅ 已完成 |
| 4 | 竞价详情与报价 | /pages/merchant/bidding/detail/index | ✅ 已完成 |
| 5 | 我的订单列表 | /pages/merchant/order/list/index | ✅ 已完成 |
| 6 | 订单详情与接单 | /pages/merchant/order/detail/index | ✅ 已完成 |
| 7 | 服务商工作台 | /pages/merchant/home | ✅ 已完成 |
| 8 | 维修厂信息 | /pages/merchant/shop/profile/index | ✅ 已完成 |

## 已完成

### 后端 API（server.js）

- `authenticateMerchant` 中间件
- `GET /api/v1/merchant/dashboard` 工作台汇总
- `GET /api/v1/merchant/biddings` 竞价邀请列表
- `GET /api/v1/merchant/bidding/:id` 竞价详情
- `POST /api/v1/merchant/quote` 提交报价
- `GET /api/v1/merchant/orders` 订单列表
- `GET /api/v1/merchant/orders/:id` 订单详情
- `POST /api/v1/merchant/orders/:id/accept` 接单
- `PUT /api/v1/merchant/orders/:id/status` 更新状态
- `GET/PUT /api/v1/merchant/shop` 本店信息

### 前端 API 封装（utils/api.js）

- `merchantRequest` 使用 merchant_token
- `getMerchantDashboard`、`getMerchantBiddings`、`getMerchantBidding`
- `submitQuote`、`getMerchantOrders`、`getMerchantOrder`
- `acceptOrder`、`updateOrderStatus`
- `getMerchantShop`、`updateMerchantShop`

## 竞价邀请逻辑

- 车主发起竞价时指定 `range_km`，竞价中心点为用户位置（users.latitude/longitude）
- 服务商请求列表时，筛选：本店在用户 `range_km` 范围内、status=0、未过期
- 若用户无位置信息，该竞价不展示给任何服务商

## 待开发页面

1. **M04 竞价邀请列表**：列表展示、Tab 筛选（待报价/已报价）、跳转详情
2. **M05 竞价详情与报价**：定损报告、报价表单、提交
3. **M06 订单列表**：按状态 Tab、卡片列表
4. **M07 订单详情**：接单、维修完成、联系车主
5. **M03 工作台**：汇总数字、快捷入口
6. **M08 维修厂信息**：查看/编辑本店信息
