# 主评价页

> **评价体系基准**：以《评价和激励体系.md》为准，本页整合全链路 4 阶评价中的**前 3 阶**（报价服务、维修过程、完工验收），服务完成后**1 屏到底、1 次提交**。

## 基本信息

| 项目 | 说明 |
|------|------|
| 页面路径 | `/pages/review/submit` |
| 页面标识 | 主评价、完工验收评价 |
| TabBar 位置 | 否 |

## 页面功能概述

**流程触发**：默认在「用户确认维修完工 + 平台完成分账结算」后弹出；后台配置 `require_settlement_before_review=0` 时，平台可提前弹出（提前返现）。不可跳过（可最小化，24 小时内再次打开 APP 强制弹出）。单页 1 屏到底，整合 3 个模块：**模块 1 报价服务**、**模块 2 维修过程**、**模块 3 完工验收**，1 次提交。提交后 **AI 秒级审核**，通过则立即发放基础奖励，不通过则标注缺项、引导补充（无提交次数限制、无惩罚）。

## 页面布局结构

| 模块 | 说明 |
|------|------|
| **顶部合规提示** | 固定展示，不可滚动隐藏：「奖励仅与评价内容的完整性、真实性挂钩，与评价正负倾向完全无关，差评达标也可全额领取奖励」 |
| 模块 1：报价服务 | 2 道客观勾选题 + 选填描述；全订单选填；完成可领合作商家权益，不影响基础奖励 |
| 模块 2：维修过程 | 材料上传区（按订单分级标注必填/选填）+ 3 道客观题；三级/四级必填，一级/二级选填 |
| 模块 3：完工验收 | 必传：维修结算清单、完工实拍图 2 张；4 道客观题；主观描述（按订单分级字数）；选填 5 维度星级；全订单 100% 必填 |
| 奖励金预估 | 按订单分级展示可获奖励金及发放节点（一级/二级 100% 全额；三级/四级 50% 基础 + 1 个月/3 个月追评发放剩余） |
| 提交按钮 | 固定在底部，实时显示「必填项完成进度」；必填项未完成时置灰，完成后高亮可点击 |

## 功能点详细说明

### 功能点 1：模块 1 报价服务（选填）

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-001 |
| 功能描述 | 报价透明度评价，全订单选填 |
| 必选客观题 | 1. 结算金额与平台确认报价一致，无隐形消费；2. 服务商已提前告知所有项目与费用，本人知情同意 |
| 选填 | 主观描述 |
| 预期结果 | 完成可领合作商家洗车/全车检测权益，不影响基础奖励 |

### 功能点 2：模块 2 维修过程（三级/四级必填）

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-002 |
| 功能描述 | 维修过程与项目合规性校验 |
| 必传材料 | 按订单分级：二级上传配件合格证；三级/四级上传新旧配件对比图、维修过程实拍图（至少 5 张）；四级另需维修过程视频、检测报告、维修发票 |
| 必选客观题 | 1. 维修项目与报修故障对应，无未经同意的额外项目；2. 配件实物与清单品牌、型号一致；3. 服务商已同步维修进度 |
| 预期结果 | 三级/四级未完成则无法提交；一级/二级选填 |

### 功能点 3：模块 3 完工验收（全订单必填）

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-003 |
| 功能描述 | 核心评价环节，奖励发放依据 |
| 必传材料 | 1. 盖有服务商公章的维修结算清单；2. 与维修项目匹配的完工实拍图 2 张 |
| 必选客观题 | 1. 本次维修的服务商与平台选定的一致；2. 结算金额与平台确认报价一致；3. 维修完成后报修故障已解决；4. 服务商已明确告知质保期限与售后保障 |
| 主观描述 | 按订单分级字数要求 |
| 选填星级 | 5 维度（报价透明度、服务态度、完工时效、维修环境、售后响应），**星级高低不影响奖励发放** |

### 功能点 4：奖励金预估展示

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-004 |
| 功能描述 | 按订单分级展示可获奖励金及发放节点 |
| 计算规则 | 奖励金三级校准（复杂度 + 车价 + 维修金额），来自 `GET /api/v1/orders/{id}/reward-preview` |
| 发放节点 | 一级/二级：审核通过 100% 全额；三级：审核通过发 50%，1 个月追评发剩余 50%；四级：审核通过发 50%，1 个月发 30%，3 个月发 20% |
| 预期结果 | 提交前显示预估奖励金；提交后显示「奖励金审核中」或「奖励金已到账」 |

## 页面参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| order_id | string | 是 | 订单 ID |

## 交互逻辑

1. **进入页面**：用户点击「确认维修完工」后全屏弹出（是否需等分账完成见流程触发）；根据 `order_id` 加载订单、维修厂、奖励金预估。
2. **必填进度**：实时校验各模块必填项，底部按钮显示完成进度；未完成置灰，完成后可点击。
3. **提交评价**：校验必填项 → 调用 `POST /api/v1/reviews` → **AI 秒级审核**。
4. **审核结果**：
   - **通过**：一级/二级立即发放 100% 全额；三级/四级立即发放 50% 基础奖励，剩余由 1 个月/3 个月追评发放。跳转订单详情或个人中心。
   - **不通过**：标注明确缺项，引导用户补充，**无提交次数限制，无惩罚**；用户可修改后重新提交。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/orders/{id} | GET | 获取订单详情 |
| /api/v1/orders/{id}/reward-preview | GET | 奖励金预估 |
| /api/v1/reviews | POST | 提交评价（扩展：各模块材料、客观题答案、主观描述） |
| /api/v1/upload/image | POST | 上传图片 |

## 请求参数示例（提交评价）

```json
{
  "order_id": "string",
  "module1": {
    "q1_settlement_match": true,
    "q2_informed": true,
    "content": "选填描述"
  },
  "module2": {
    "materials": ["url1", "url2"],
    "q1_project_match": true,
    "q2_parts_match": true,
    "q3_progress_synced": true
  },
  "module3": {
    "settlement_list_image": "url",
    "completion_images": ["url1", "url2"],
    "q1_shop_match": true,
    "q2_settlement_match": true,
    "q3_fault_resolved": true,
    "q4_warranty_informed": true,
    "content": "主观描述",
    "ratings": {
      "price_transparency": 5,
      "service": 5,
      "timeliness": 5,
      "environment": 5,
      "after_sales": 5
    }
  },
  "is_anonymous": false
}
```

## 异常与边界

- 订单不存在或已评价：提示并返回。
- 是否需等分账完成：由后台 `require_settlement_before_review` 配置决定，未分账完成时可能禁止评价或允许提前返现。
- 审核不通过：展示缺项说明，用户可补充后重新提交，无次数限制。
- 照片/材料不足：按模块要求提示必传项。
