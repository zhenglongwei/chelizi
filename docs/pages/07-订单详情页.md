# 订单详情页

## 基本信息

| 项目 | 说明 |
|------|------|
| 页面路径 | `/pages/order/detail` |
| 页面标识 | 订单详情、维修订单 |
| TabBar 位置 | 否 |

## 页面功能概述

展示单个维修订单的完整信息，包括订单状态、工期计时器、车辆信息、损伤情况、报价、维修方案、增值服务、维修厂、维修方案待确认等，支持取消订单、确认完成、去评价等操作。**布局参照服务商端订单详情，不含佣金等专属信息**。

## 页面功能概述（补充）

需求文档中，用户选择维修厂后「跳转到订单详情页」，因此需要独立的订单详情页，用于查看订单状态、联系维修厂、取消订单、确认完成、提交评价等。详见《维修方案调整与确认流程.md》中车主端确认逻辑。

## 页面布局结构

| 模块 | 说明 |
|------|------|
| 订单状态 | 待接单、维修中、待确认完成、已完成、已取消等 |
| 工期计时器 | 待接单/维修中时展示：工期天数、截止日期、剩余时间倒计时 |
| 车辆信息 | 品牌、车型、车牌（来自定损报告） |
| 损伤情况 | 来自定损报告，损伤部位与类型 |
| 报价 | 金额、工期、质保（来自 repair_plan 或 quote） |
| 维修方案 | 维修项目列表、增值服务（来自 repair_plan 或 quote） |
| 维修厂 | 名称、拨打电话、地址 |
| 维修方案待确认 | repair_plan_status=1 时展示，同意/不同意按钮 |
| 奖励金预估 | 待确认/待评价/可追评时展示 |
| 操作按钮 | 联系维修厂、确认完成、去评价、去追评、撤销订单、提交人工通道 |

## 功能点详细说明

### 功能点 1：订单状态展示

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-001 |
| 功能描述 | 展示当前订单状态及进度 |
| 状态说明 | 待接单、已接单、维修中、待确认完成、已完成、已取消 |
| 预期结果 | 状态文案清晰；进度时间线展示关键节点 |

### 功能点 2：取消订单

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-002 |
| 功能描述 | 车主撤销订单（仅车主可发起，服务商不允许撤单） |
| 操作流程 | 点击撤销 → 确认（超 30 分钟需填写理由）→ 调用接口 |
| 撤销规则 | 详见《订单撤单与维修完成流程.md》：未接单随时可撤；接单 ≤30 分钟随时可撤；接单 >30 分钟需服务商同意或人工处理 |
| 预期结果 | 直接撤销：订单已取消、竞价重开；申请撤销：进入撤单申请流程，服务商同意/拒绝或提交人工 |
| 服务商拒绝后 | 订单保持原状态，通知车主；车主可选择**继续交易**或**提交人工通道**；提交人工后由后台人员决定是否取消 |

### 功能点 3：确认完成

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-003 |
| 功能描述 | 维修厂完成后，用户点击「确认维修完工」 |
| 操作流程 | 点击确认完成 → 确认 → 调用接口 |
| 预期结果 | 状态变为待评价；**立即全屏弹出主评价页**。默认流程为「用户确认完工 + 平台分账完成」后弹出；配置 `require_settlement_before_review=0` 时可提前弹出 |

### 功能点 4：去评价 / 追评

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-004 |
| 功能描述 | 主评价：确认完工后全屏弹出；追评：随时可追加，不限制时间与次数 |
| 主评价 | 点击确认完工 → 全屏弹出 `/pages/review/submit?order_id=xxx`，1 屏 3 模块 1 次提交 |
| 追评 | 订单详情/消息中心入口，弹窗形式；可选 1 个月/3 个月推送引导；判定结合质保期等，详见 02 文档 2.5 |
| 奖励金提示 | 按订单分级展示可获奖励金预估；待追评时提示「补充追评、上传更多实拍图可提升内容等级，获得更多奖励金」。详见《15-追评页》前端文案指引 |

### 功能点 5：联系维修厂

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-005 |
| 功能描述 | 拨打电话或打开聊天 |
| 操作流程 | 点击电话/咨询 |
| 预期结果 | 调起拨号或客服会话 |

### 功能点 6：维修方案待确认

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-006 |
| 功能描述 | 服务商调整维修方案后，车主确认同意或不同意 |
| 展示条件 | repair_plan_status=1（待车主确认）时展示 |
| 操作流程 | 查看调整后的维修项目 → 点击「同意」或「不同意」 |
| 预期结果 | 同意：repair_plan_status=0，服务商可点击维修完成；不同意：repair_plan_status=2，提示联系客服 |
| 详见 | 《维修方案调整与确认流程.md》 |

## 页面参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 订单 ID（order_id） |

## 交互逻辑

1. **进入页面**：根据 `id` 加载订单详情，校验是否本人订单。
2. **状态驱动**：根据状态展示不同操作（取消、确认完成、去评价等）。
3. **取消**：按撤单规则显示撤销入口；已完成不显示；超 30 分钟显示「申请撤销」并需填写理由。
4. **去评价**：已完成且未评价时显示；已评价可展示评价结果或隐藏。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/user/orders/{id} | GET | 获取订单详情（含 vehicle_info、analysis_result、quote、repair_plan） |
| /api/v1/user/orders/{id}/reward-preview | GET | 奖励金预估 |
| /api/v1/user/orders/{id}/cancel | POST | 撤销订单（直接或创建撤单申请） |
| /api/v1/user/orders/{id}/cancel-request/{requestId}/escalate | POST | 撤单申请被拒后，车主提交人工通道 |
| /api/v1/user/orders/{id}/confirm | POST | 确认维修完成 |
| /api/v1/user/orders/{id}/repair-plan/approve | POST | 车主确认维修方案（同意/不同意） |

## 异常与边界

- 订单不存在或非本人：提示并返回。
- 重复取消/确认：接口幂等或提示已操作。
- 超时未确认：可按业务规则自动完成或关闭。
