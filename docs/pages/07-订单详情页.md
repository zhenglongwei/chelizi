# 订单详情页

## 基本信息

| 项目 | 说明 |
|------|------|
| 页面路径 | `/pages/order/detail` |
| 页面标识 | 订单详情、维修订单 |
| TabBar 位置 | 否 |

## 页面功能概述

展示单个维修订单的完整信息，包括订单状态、维修厂、报价、进度、联系方式等，支持取消订单、确认完成、去评价等操作。

## 页面功能概述（补充）

需求文档中，用户选择维修厂后「跳转到订单详情页」，因此需要独立的订单详情页，用于查看订单状态、联系维修厂、取消订单、确认完成、提交评价等。

## 页面布局结构

| 模块 | 说明 |
|------|------|
| 订单状态 | 待接单、已接单、维修中、待确认、已完成、已取消等 |
| 维修厂信息 | 名称、地址、电话、导航 |
| 报价详情 | 报价金额、维修项目、工期、质保 |
| 车辆信息 | 车牌、车型等 |
| 进度时间线 | 发起、接单、维修中、完成等节点 |
| 操作按钮 | 取消订单、联系维修厂、确认完成、去评价 |

## 功能点详细说明

### 功能点 1：订单状态展示

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-001 |
| 功能描述 | 展示当前订单状态及进度 |
| 状态说明 | 待接单、已接单、维修中、待确认完成、已完成、已取消 |
| 预期结果 | 状态文案清晰；进度时间线展示关键节点 |

### 功能点 2：取消订单

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-002 |
| 功能描述 | 用户取消订单 |
| 操作流程 | 点击取消 → 确认 → 调用取消接口 |
| 限制 | 仅限 24 小时内可取消（按需求文档） |
| 预期结果 | 取消后订单变为已取消；可重新发起竞价 |

### 功能点 3：确认完成

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-003 |
| 功能描述 | 维修厂完成后，用户点击「确认维修完工」 |
| 操作流程 | 点击确认完成 → 确认 → 调用接口 |
| 预期结果 | 状态变为待评价；**立即全屏弹出主评价页**。默认流程为「用户确认完工 + 平台分账完成」后弹出；配置 `require_settlement_before_review=0` 时可提前弹出 |

### 功能点 4：去评价 / 追评

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-004 |
| 功能描述 | 主评价：确认完工后全屏弹出；追评：1 个月/3 个月弹窗推送 |
| 主评价 | 点击确认完工 → 全屏弹出 `/pages/review/submit?order_id=xxx`，1 屏 3 模块 1 次提交 |
| 追评 | 1 个月/3 个月通过推送 + 站内信弹窗触发，非页面跳转；消息中心可提供追评入口 |
| 奖励金提示 | 按订单分级展示可获奖励金预估及发放节点（基础 50%、1 个月 30%、3 个月 20% 等） |

### 功能点 5：联系维修厂

| 项目 | 说明 |
|------|------|
| 功能 ID | F-ORDER-DETAIL-005 |
| 功能描述 | 拨打电话或打开聊天 |
| 操作流程 | 点击电话/咨询 |
| 预期结果 | 调起拨号或客服会话 |

## 页面参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 订单 ID（order_id） |

## 交互逻辑

1. **进入页面**：根据 `id` 加载订单详情，校验是否本人订单。
2. **状态驱动**：根据状态展示不同操作（取消、确认完成、去评价等）。
3. **取消**：24 小时内显示取消；超过则隐藏。
4. **去评价**：已完成且未评价时显示；已评价可展示评价结果或隐藏。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/order/{id} | GET | 获取订单详情 |
| /api/v1/order/{id}/cancel | POST | 取消订单 |
| /api/v1/order/{id}/confirm | POST | 确认维修完成 |

## 异常与边界

- 订单不存在或非本人：提示并返回。
- 重复取消/确认：接口幂等或提示已操作。
- 超时未确认：可按业务规则自动完成或关闭。
