# 追评弹窗

> **评价体系变更**：追评由独立页面改为**弹窗**形式，1 个月/3 个月通过推送 + 站内信弹窗触发；返厂评价等同于追评，复用本弹窗。以《评价和激励体系.md》为准。**给车主足够时间发现问题**。

## 基本信息

| 项目 | 说明 |
|------|------|
| 展示形式 | **弹窗**（非独立路由，无页面跳转） |
| 页面标识 | 1 个月追评、3 个月追评、返厂评价 |
| 触发方式 | APP 推送 + 站内信弹窗，点击直接打开 |

## 页面功能概述

维修完工后第 1 个月推送**1 个月追评弹窗**；四级订单在第 3 个月推送**3 个月追评弹窗**。弹窗 1 屏极简，10 秒可完成。三级/四级订单必填，一级/二级选填。**一级/二级选填**：提交后可领取**额外权益**（车险优惠券、免费全车检测等），**不影响基础奖励**（基础奖励已在主评价审核通过时 100% 发放）。**三级/四级必填**：提交审核通过后发放对应比例奖励金（三级剩余 50%，四级 1 个月 30% + 3 个月 20%）。

## 页面布局结构（1 个月追评）

| 模块 | 说明 |
|------|------|
| 订单/评价信息 | 维修厂、维修项目、完工时间 |
| 必选客观题 | 1. 故障是否复发；2. 有无新增异常 |
| 使用体验描述 | 10 字以上必填 |
| 奖励金提示 | 三级/四级：通过审核后发放对应比例；一级/二级：选填完成可领额外权益（车险优惠券等），不影响基础奖励 |
| 提交按钮 | 提交追评 |

## 页面布局结构（3 个月追评，仅四级订单）

| 模块 | 说明 |
|------|------|
| 订单/评价信息 | 维修厂、维修项目、完工时间 |
| 必选客观题 | 1. 故障是否复发；2. 配件是否正常；3. 售后是否响应 |
| 长期体验描述 | 20 字以上必填 |
| 奖励金提示 | 通过审核后发放剩余 20% 奖励金 |
| 提交按钮 | 提交追评 |

## 返厂评价

返厂评价**等同于追评**，复用本弹窗流程，扩展参数 `is_return_visit: true`。用户车辆返厂维修后，通过推送/站内信触发弹窗，流程与 1 个月追评一致。

## 功能点详细说明

### 功能点 1：追评条件校验

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-FOLLOW-001 |
| 功能描述 | 校验是否满足追评条件 |
| 1 个月追评 | 维修完工后第 1 个月推送；三级/四级必填，一级/二级选填 |
| 3 个月追评 | 仅四级订单展示，完工后第 3 个月推送 |
| 预期结果 | 不满足则弹窗不展示或提示已过期 |

### 功能点 2：提交追评

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-FOLLOW-002 |
| 功能描述 | 提交追评内容 |
| 操作流程 | 填写客观题 + 描述（10 字/20 字）→ 点击提交 |
| 预期结果 | 调用 `POST /api/v1/reviews/{id}/followup`；扩展 `stage`（1m/3m）、`is_return_visit`；通过后发放对应比例奖励金 |
| 备注 | 追评与返厂评价复用同一接口，`is_return_visit` 区分 |

### 功能点 3：奖励金展示

| 项目 | 说明 |
|------|------|
| 功能 ID | F-REVIEW-FOLLOW-003 |
| 功能描述 | 展示追评可得奖励金 |
| 计算规则 | 三级：1 个月通过发剩余 50%；四级：1 个月发 30%、3 个月发 20% |
| 预期结果 | 提交前显示预估；提交后显示「奖励金审核中」或「奖励金已到账」 |

## 弹窗参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| review_id | string | 是 | 主评价 ID |
| stage | string | 是 | 1m / 3m |
| order_id | string | 否 | 订单 ID（若接口需要） |
| is_return_visit | boolean | 否 | 是否返厂评价 |

## 交互逻辑

1. **触发**：1 个月/3 个月推送或站内信点击 → 直接打开弹窗，无页面跳转。
2. **不满足条件**：弹窗不展示或提示「追评已过期」「您已完成追评」。
3. **提交**：校验必填（客观题 + 字数）→ 调用 followup 接口 → 展示结果 → 关闭弹窗。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/reviews/{id} | GET | 获取主评价详情，用于校验和展示 |
| /api/v1/reviews/{id}/followup | POST | 提交追评；扩展：`stage`（1m/3m）、`is_return_visit`、客观题答案、字数校验 |

## 后端依赖

- **定时任务**：需在维修完工第 1 个月、第 3 个月（仅四级）触发推送 + 站内信，引导用户打开追评弹窗。

## 异常与边界

- 已追评：提示「您已提交过追评」。
- 超过 1 个月/3 个月：弹窗可仍展示，但奖励规则按产品确认。
- 消息中心：可提供追评入口作为补充，点击后弹窗展示。
