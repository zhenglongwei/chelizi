# 竞价报价页

## 基本信息

| 项目 | 说明 |
|------|------|
| 页面路径 | `/pages/bidding/detail` |
| 页面标识 | 竞价报价、报价列表 |
| TabBar 位置 | 否 |

## 页面功能概述

展示某次竞价的报价列表，按保险/自费模式排序，用户选择维修厂后生成维修订单。

## 页面布局结构

| 模块 | 说明 |
|------|------|
| 竞价状态 | 倒计时、已报价数量 |
| AI 定损报告 | 可展开/折叠查看 |
| 报价列表 | 维修厂报价列表，按规则排序；**报价免责提示**：「此报价仅供参考，以实际维修时为准」 |
| 报价卡片 | 维修厂信息、报价金额、预计工期、质保、报价明细（损失部位、维修方案、配件类型）；报价明细展开区及确认选择弹窗旁均有免责提示 |
| 支付方式 | 展示竞价发起时选择的支付方式（保险支付/自费），不可修改 |
| 选择按钮 | 选择某家维修厂 |

## 功能点详细说明

### 功能点 1：报价排序（保险支付）

| 项目 | 说明 |
|------|------|
| 功能 ID | F-BIDDING-001 |
| 功能描述 | 保险支付时按综合评分排序，优先高报价 |
| 排序公式 | 综合评分 = 报价金额（标准化） × 0.4 + 维修厂评分 × 0.3 + 历史偏差率得分 × 0.2 + 响应速度 × 0.1 |
| 预期结果 | 高报价商家排名靠前；展示综合评分及子项 |

### 功能点 2：报价排序（自费）

| 项目 | 说明 |
|------|------|
| 功能 ID | F-BIDDING-002 |
| 功能描述 | 自费时按价格从低到高排序 |
| 排序规则 | 1. 报价金额升序 2. 同价按评分降序 3. 展示「省 XX 元」对比最高价 |
| 预期结果 | 价格升序；同价高分靠前；显示省多少钱 |

### 功能点 3：选择维修厂

| 项目 | 说明 |
|------|------|
| 功能 ID | F-BIDDING-003 |
| 功能描述 | 用户选择维修厂并确认维修 |
| 操作流程 | 1. 点击「选择」 2. 弹出确认框展示报价详情 3. 确认后生成维修订单 4. 通知维修厂接单 5. 跳转订单详情页 |
| 预期结果 | 确认后生成订单，展示订单详情和维修厂联系方式 |
| 备注 | 选择后竞价结束；24 小时内可取消订单；取消后需重新发起竞价 |

## 页面参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 竞价 ID（bidding_id） |

## 交互逻辑

1. **进入页面**：根据 `id` 加载竞价详情、报价列表；按竞价发起时的支付类型排序（保险支付/自费），支付方式不可修改。
3. **选择维修厂**：点击选择 → 弹窗确认 → 调用 select 接口 → 成功后跳转 `/pages/order/detail?id={order_id}`。
4. **倒计时**：实时显示剩余时间；结束时自动结束竞价，禁止选择。
5. **实时更新**：新报价进入时，可轮询或 WebSocket 刷新列表。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/bidding/{id} | GET | 获取竞价详情 |
| /api/v1/bidding/{id}/quotes | GET | 获取报价列表（含 sort_type） |
| /api/v1/bidding/{id}/select | POST | 选择维修厂 |

## 异常与边界

- 竞价不存在或已结束：提示并返回上一页或首页。
- 无报价：提示等待维修厂报价或扩大范围。
- 选择失败：展示错误信息，保留在当前页。
- 未登录：跳转登录后再进入。
