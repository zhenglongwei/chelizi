# 登录授权页

## 基本信息

| 项目 | 说明 |
|------|------|
| 页面路径 | `/pages/auth/login` |
| 页面标识 | 登录、微信授权 |
| TabBar 位置 | 否 |

## 页面功能概述

微信小程序登录与授权入口。通过微信登录获取用户身份，可选获取手机号、用户信息等授权，用于需要登录才能使用的功能。

## 页面布局结构

| 模块 | 说明 |
|------|------|
| 平台 Logo/名称 | 事故车维修平台 |
| 授权说明 | 登录后可使用的功能说明 |
| 微信登录按钮 | 触发 wx.login 获取 code |
| 用户信息授权 | 获取昵称、头像（按微信规范使用 button 获取） |
| 手机号授权 | 可选，用于联系、提现等 |
| 服务协议/隐私政策 | 勾选同意后允许登录 |

## 功能点详细说明

### 功能点 1：微信登录

| 项目 | 说明 |
|------|------|
| 功能 ID | F-AUTH-001 |
| 功能描述 | 使用微信 code 换取 token 和用户标识 |
| 操作流程 | 1. 用户点击登录 2. wx.login 获取 code 3. 调用 /api/v1/auth/login 4. 保存 token |
| 预期结果 | 登录成功，跳转至来源页或首页 |
| 备注 | 需处理 code 换取 session 的逻辑 |

### 功能点 2：用户信息授权

| 项目 | 说明 |
|------|------|
| 功能 ID | F-AUTH-002 |
| 功能描述 | 获取用户昵称、头像 |
| 操作流程 | 使用 button open-type="chooseAvatar" 等（按微信最新规范） |
| 预期结果 | 更新用户资料到服务端 |
| 备注 | 遵循微信用户信息获取最新规则 |

### 功能点 3：手机号授权

| 项目 | 说明 |
|------|------|
| 功能 ID | F-AUTH-003 |
| 功能描述 | 获取用户手机号（用于提现、联系等） |
| 操作流程 | 使用 button open-type="getPhoneNumber" |
| 预期结果 | 解密获取手机号，保存到用户资料 |
| 备注 | 企业认证小程序方可使用；用户拒绝时可稍后引导 |

### 功能点 4：协议勾选

| 项目 | 说明 |
|------|------|
| 功能 ID | F-AUTH-004 |
| 功能描述 | 用户需同意服务协议、隐私政策方可登录 |
| 操作流程 | 勾选同意后，登录按钮可用 |
| 预期结果 | 未勾选无法登录；勾选后允许继续 |

## 页面参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| redirect | string | 否 | 登录成功后跳转路径（需 url 编码） |
| from | string | 否 | 来源标识 |

## 交互逻辑

1. **进入页面**：检查是否已登录；已登录可直接 redirect 或返回首页。
2. **登录流程**：获取 code → 调用 login 接口 → 保存 token → 按 redirect 跳转。
3. **授权失败**：提示用户重试或说明为何需要授权。
4. **首次登录**：可引导完善头像、昵称、手机号。

## 依赖接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/auth/login | POST | 微信登录，入参 { code }，返回 token、user |

## 异常与边界

- code 失效：重新 wx.login 再请求。
- 网络错误：提示检查网络并重试。
- 用户拒绝授权：说明影响，允许稍后在设置中补充。
- redirect 无效：回退到首页或个人中心。
