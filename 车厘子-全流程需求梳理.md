# 车厘子 - 全流程需求梳理

版本：v1.0  
日期：2026年2月  
适用范围：车主端、汽修服务商端、后台运维

---

## 一、三端角色与业务闭环

```
┌─────────────┐    竞价/订单     ┌─────────────┐    审核/配置     ┌─────────────┐
│   车主端    │ ◄──────────────► │ 汽修服务商  │ ◄──────────────► │  后台运维   │
│  (小程序)   │                  │  (小程序内)  │                  │  (Web 管理) │
└─────────────┘                  └─────────────┘                  └─────────────┘
```

| 角色 | 载体 | 核心职责 |
|------|------|----------|
| 车主端 | 微信小程序 | 定损、发起竞价、选厂、订单、评价、返点 |
| 汽修服务商 | 同一小程序内（设置→服务商入口） | 接收竞价、报价、接单、维修、更新订单状态 |
| 后台运维 | Web 管理后台（`web/`） | 维修厂审核、订单监控、结算、配置、数据统计 |

---

## 二、完整业务流（三端协同）

### 2.1 竞价报价流程

| 步骤 | 车主端 | 汽修服务商 | 后台运维 |
|------|--------|------------|----------|
| 1 | 上传照片 → AI 定损 → 发起竞价 | - | - |
| 2 | - | 收到竞价邀请 → 查看定损报告 → 提交报价 | - |
| 3 | 查看报价列表 → 选择维修厂 → 生成订单 | - | - |
| 4 | - | 收到订单通知 → 接单 | 可查看订单列表 |

### 2.2 维修完成流程

| 步骤 | 车主端 | 汽修服务商 | 后台运维 |
|------|--------|------------|----------|
| 1 | - | 维修中 → 更新为「待用户确认」 | - |
| 2 | 确认完成 → 去评价 | - | - |
| 3 | 上传维修后照片 → 提交评价 → 获得返点 | - | 可查看结算、统计 |

### 2.3 当前缺口

- **汽修服务商**：竞价邀请接收、报价提交、订单管理尚未实现，当前依赖开发环境「模拟报价」测试
- **后台运维**：管理后台已有框架，但部分接口与车厘子数据模型需对齐（如 merchant_users、shops、orders）

---

## 三、汽修服务商端（小程序内）

### 3.1 入口

- 车主端：个人中心 → 设置 → **服务商注册** / **服务商登录**
- 页面路径：`/pages/merchant/register`、`/pages/merchant/login`

### 3.2 服务商端页面与功能

| 序号 | 页面 | 路径 | 功能说明 |
|------|------|------|----------|
| M1 | 服务商登录 | /pages/merchant/login | 手机号+密码 或 微信快捷登录 |
| M2 | 服务商注册 | /pages/merchant/register | 企业名称、联系人、手机号、资质上传、提交审核 |
| M3 | 服务商工作台 | /pages/merchant/home | 待报价数量、待接单数量、维修中订单数、快捷入口 |
| M4 | 竞价邀请列表 | /pages/merchant/bidding/list | 收到的竞价列表，按距离/时间筛选 |
| M5 | 竞价详情与报价 | /pages/merchant/bidding/detail | 查看定损报告、车辆信息、提交报价（金额、项目、工期、质保） |
| M6 | 我的订单列表 | /pages/merchant/order/list | 待接单、维修中、待确认、已完成 |
| M7 | 订单详情 | /pages/merchant/order/detail | 接单、更新状态（维修中→待确认）、联系车主 |
| M8 | 维修厂信息 | /pages/merchant/shop/profile | 查看/编辑本店信息（名称、地址、电话、营业时间） |

### 3.3 服务商端依赖接口（需新增）

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/merchant/login | POST | 服务商登录（手机号+密码） |
| /api/v1/merchant/register | POST | 服务商注册 |
| /api/v1/merchant/biddings | GET | 获取邀请本店的竞价列表（需按 shop_id 过滤） |
| /api/v1/merchant/bidding/:id | GET | 获取竞价详情（含定损报告） |
| /api/v1/merchant/quote | POST | 提交报价 |
| /api/v1/merchant/orders | GET | 获取本店订单列表 |
| /api/v1/merchant/orders/:id | GET | 获取订单详情 |
| /api/v1/merchant/orders/:id/accept | POST | 接单 |
| /api/v1/merchant/orders/:id/status | PUT | 更新订单状态（维修中/待确认） |
| /api/v1/merchant/shop | GET/PUT | 获取/更新本店信息 |

### 3.4 竞价邀请机制

- 车主发起竞价时，根据 `range_km`、地理位置筛选附近维修厂
- 方案 A：系统主动推送竞价 ID 给维修厂（需消息/推送能力）
- 方案 B：服务商端轮询「邀请本店的竞价」列表（推荐，实现简单）

---

## 四、后台运维（Web 管理）

### 4.1 目录与入口

- 源码：`web/`（Vite + React + Ant Design）
- 部署：`web/dist/` → 服务器 `/var/www/simplewin/assets/`
- 入口：`https://simplewin.cn/`（官网）、`https://simplewin.cn/admin/login`（管理后台）

### 4.2 后台页面与功能

| 序号 | 页面 | 路由 | 功能说明 |
|------|------|------|----------|
| A1 | 登录 | /admin/login | 管理员账号密码登录 |
| A2 | 工作台 | /admin/dashboard | 概览：订单数、维修厂数、今日数据 |
| A3 | 维修厂管理 | /admin/merchants | 商户列表、审核（待审核/已通过）、搜索 |
| A4 | 订单管理 | /admin/orders | 订单列表、筛选、详情、报价审核 |
| A5 | 规则配置 | /admin/rules | 竞价规则、偏差惩罚、返点比例 |
| A6 | 结算管理 | /admin/settlement | 佣金结算、提现审核 |
| A7 | 纠纷管理 | /admin/disputes | 投诉/纠纷列表、处理 |
| A8 | 数据统计 | /admin/statistics | 订单量、GMV、维修厂分布 |
| A9 | 系统配置 | /admin/config | AI 调用限制、全局参数 |

### 4.3 后台依赖接口（已存在）

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/admin/login | POST | 管理员登录 |
| /api/v1/admin/merchants | GET | 商户列表 |
| /api/v1/admin/merchants/:id/audit | POST | 商户审核 |
| /api/v1/admin/orders | GET | 订单列表 |
| /api/v1/admin/orders/:orderNo | GET | 订单详情 |
| /api/v1/admin/orders/:orderNo/audit-quote | POST | 报价审核 |
| /api/v1/admin/statistics | GET | 数据统计 |
| /api/v1/admin/settlements | GET | 结算列表 |
| /api/v1/admin/complaints | GET | 纠纷列表 |
| /api/v1/admin/config | GET/PUT | 系统配置 |

### 4.4 后台与车厘子数据模型对齐

- `merchant_users` 表：服务商账号，关联 `shop_id`
- `shops` 表：维修厂信息，需由后台或服务商注册时创建/维护
- 订单状态：0 待接单、1 维修中、2 待确认、3 已完成、4 已取消
- 后台管理端字段名（如 orderNo、merchantId）与 API 返回需保持一致

---

## 五、开发计划（三端协同）

### 5.1 阶段划分

| 阶段 | 目标 | 范围 |
|------|------|------|
| 阶段一 | 车主端闭环 | 已完成：定损→竞价→选厂→订单→评价 |
| 阶段二 | 服务商端闭环 | 服务商登录/注册、竞价邀请、报价、订单管理 |
| 阶段三 | 后台运维闭环 | 维修厂审核、订单监控、配置、统计与车厘子数据对齐 |
| 阶段四 | 全流程联调 | 三端联调、消息推送（可选） |

### 5.2 服务商端开发顺序

| 顺序 | 页面/功能 | 说明 |
|------|-----------|------|
| 1 | 服务商登录 | 手机号+密码，与 merchant_users 关联 |
| 2 | 服务商注册 | 创建 merchant_users、shops（或待审核） |
| 3 | 竞价邀请列表 | 获取邀请本店的竞价列表 |
| 4 | 竞价详情与报价 | 查看报告、提交报价 |
| 5 | 我的订单列表 | 本店订单，按状态筛选 |
| 6 | 订单详情与接单 | 接单、更新状态 |
| 7 | 服务商工作台 | 汇总入口 |
| 8 | 维修厂信息 | 查看/编辑本店信息 |

### 5.3 后台运维开发顺序

| 顺序 | 页面/功能 | 说明 |
|------|-----------|------|
| 1 | 登录与数据模型对齐 | 确保 admin 接口与 shops/orders 一致 |
| 2 | 维修厂管理 | 列表、审核、与 merchant_users 关联 |
| 3 | 订单管理 | 列表、详情、状态与车厘子一致 |
| 4 | 系统配置 | AI 限制、返点比例等 |
| 5 | 数据统计 | 订单、GMV、维修厂 |
| 6 | 结算管理 | 佣金、提现 |
| 7 | 纠纷管理 | 投诉处理 |

### 5.4 依赖关系

```
服务商注册/登录、shops 数据
        ↓
竞价邀请（需 shops 有地理位置）
        ↓
服务商报价 → 车主选厂 → 订单
        ↓
后台：维修厂审核、订单监控、结算
```

---

## 六、文档索引

| 文档 | 路径 | 说明 |
|------|------|------|
| 页面索引（三端） | docs/pages/00-页面索引.md | 车主端、服务商端、后台运维全部页面索引 |
| 车主端单页文档 | docs/pages/01-*.md ~ 17-*.md | 各页面功能、参数、交互、接口 |
| 服务商端单页文档 | docs/pages/M01-*.md ~ M08-*.md | 各页面功能、参数、交互、接口 |
| 后台运维单页文档 | docs/pages/A01-*.md ~ A09-*.md | 各页面功能、参数、交互、接口 |
| 协作规范 | 协作规范.md | 开发约束、页面顺序 |
| 设计规范 | 设计规范.md | UI、样式、设计令牌（小程序适用） |
| 数据库设计 | docs/database/数据库设计文档.md | 表结构、字段 |
| 部署清单 | web/部署清单.md | 部署步骤、API 更新说明 |

---

## 七、附录：服务商端与后台 API 对照

### 服务商端（小程序内）

- 认证：`Authorization: Bearer <merchant_token>`（merchant 登录后颁发）
- 基础路径：`/api/v1/merchant/`

### 后台运维（Web）

- 认证：`Authorization: Bearer <admin_token>`（admin 登录后颁发）
- 基础路径：`/api/v1/admin/`

### 车主端（小程序）

- 认证：`Authorization: Bearer <user_token>`（微信登录后颁发）
- 基础路径：`/api/v1/`（user、bidding、shops、reviews 等）
