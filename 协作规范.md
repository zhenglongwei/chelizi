# 协作规范

**版本**：v1.1 | **更新**：2026-02

本规范为协作总入口。**具体条款见下方「规范目录」中各文件**；需要某类约束时，先在本目录找到对应文件，再在该文件中搜索具体内容。

---

## 快速入口（按任务类型直达）

| 任务类型 | 必读文档 | 说明 |
|----------|----------|------|
| **改/新增小程序页面** | [设计规范.md](设计规范.md)、[styles/design-system.wxss](styles/design-system.wxss)、[docs/pages/00-页面索引.md](docs/pages/00-页面索引.md) | 样式用 `var(--xxx)`，禁止硬编码；先查页面索引找对应功能说明 |
| **改接口/数据库** | [docs/database/数据库设计文档.md](docs/database/数据库设计文档.md)、`web/database/schema.sql` | 表/字段/索引变更需同步更新设计文档和 schema |
| **改评价/奖励金/防刷** | [评价和激励体系.md](评价和激励体系.md)、[docs/评价奖励金体系-设计方案.md](docs/评价奖励金体系-设计方案.md) | 奖励金、4 阶评价、防刷管控、合规红线 |
| **改竞价流程** | [docs/竞价流程与状态流转.md](docs/竞价流程与状态流转.md) | 竞价创建→报价→选厂/结束、状态定义 |
| **改服务商端** | [车厘子-全流程需求梳理.md](车厘子-全流程需求梳理.md) 5.2 节、[docs/pages/00-页面索引.md](docs/pages/00-页面索引.md) | M01-M08 页面功能说明 |
| **改后台运维** | [车厘子-全流程需求梳理.md](车厘子-全流程需求梳理.md) 5.3 节、[docs/pages/00-页面索引.md](docs/pages/00-页面索引.md) | A01-A12 页面功能说明 |

> Cursor 用户：`.cursor/rules/` 下已配置任务型规则，打开相关文件时自动生效。

---

## 固定约束（每次需求默认生效）

- **语言**：所有回复使用**中文简体**。
- **产品与文档基准**：产品名称为**车厘子**。需求以《车厘子需求文档.md》为准，**全流程（车主端、汽修服务商、后台运维）以《车厘子-全流程需求梳理.md》为准**，**UI 以《设计规范.md》为准**（浅色主题），评价与激励体系以《评价和激励体系.md》为准；**车主端**严格按上述文档实现。
- **第一次开发不做兼容**：不兼容旧字段/旧返回结构；发现双格式或兼容分支即统一为唯一格式。改完同步更新文档。
- **最小可用闭环**：实现到能**开发/测试/查询/查看/提交**（或触发关键动作），并具备基础错误提示。
- **页面开发优先级**：修改或新增页面时，**以《设计规范.md》为准**，可参考 `docs/pages/` 下对应 .html 与设计说明文档；样式与设计令牌严格按《设计规范.md》实现。
- **样式约束**：**小程序页面**均通过 `app.wxss` 自动引用 `styles/design-system.wxss`，**禁止硬编码颜色**（如 `#333`、`#fff`）和**尺寸**（如 `24rpx`），必须使用 `var(--xxx)` 或预定义工具类。**后台运维**为 Web 页面，样式独立，使用 Ant Design，不参考《设计规范.md》。
- **WXML 动态 style**：禁止在 `style` 属性中混写静态与动态，如 `style="width: {{x}}%"`。动态样式须在 data 中维护完整字符串，wxml 使用 `style="{{styleKey}}"`。例如：`data: { progressStyle: 'width: 0%' }`，更新时 `setData({ progressStyle: 'width: ' + p + '%' })`。
- **图标约束**：图标统一使用 `images/icon/` 目录下的 PNG 文件，禁止使用网络图标或 emoji 替代。若图标不存在，可在代码中先写明路径并注释说明所需图标颜色/样式，提醒后续补充。
- **全局问题落档**：若遇到的问题属于**全局问题**（如页边距、字号、布局模式等影响多个页面的问题），必须将解决方案写入两个全局文件：`styles/design-system.wxss`（可执行代码、变量、工具类）和《设计规范.md》（规范说明、约束条款）。
- **服务商注册字段约定**：**法定代表人**（营业执照上的法人）与**联系人**（日常业务对接人）为不同概念，注册表单中两者均需填写，不可混淆或合并。
- **需求沟通方式**：每收到一个需求，应先通过**提问**明确：真实意图、边界、特殊情况等；确认无歧义后再开始写代码，**禁止一上来就写代码**。

---

## AI Agent 分岗管理（可选）

项目支持**分岗位 AI Agent** 协作开发，将分散文档分门别类由不同岗位 Agent 管理。详见 [docs/agents/00-Agent体系总览.md](docs/agents/00-Agent体系总览.md)。

**使用建议**：
- **日常开发**：优先使用 `.cursor/rules/` 任务型规则 + 快速入口，无需分岗
- **复杂任务**：多角色协作、需求评审、架构设计时，可引入对应 Agent 提示词
- **评估**：若团队规模小、以单人/AI 协作为主，可弱化分岗，仅保留规则与快速入口

| 岗位 | 提示词文件 | 负责文档 |
|------|------------|----------|
| 产品经理 | [01-产品经理-Agent.md](docs/agents/01-产品经理-Agent.md) | 需求、流程、评价体系、防刷规范 |
| 架构师 | [02-架构师-Agent.md](docs/agents/02-架构师-Agent.md) | 数据库、接口、技术架构 |
| UI/UX 设计师 | [03-UIUX设计师-Agent.md](docs/agents/03-UIUX设计师-Agent.md) | 设计规范、design-system.wxss |
| 前端开发 | [04-前端开发-Agent.md](docs/agents/04-前端开发-Agent.md) | 页面功能说明、小程序规范 |
| 后端开发 | [05-后端开发-Agent.md](docs/agents/05-后端开发-Agent.md) | 接口实现、数据库操作 |
| 测试工程师 | [06-测试工程师-Agent.md](docs/agents/06-测试工程师-Agent.md) | 测试用例、E2E 经验 |
| 项目经理 | [07-项目经理-Agent.md](docs/agents/07-项目经理-Agent.md) | 协作规范、开发计划、阶段划分 |

使用方式：将对应岗位的提示词内容复制到对话中，或创建 `.cursor/rules/` 规则引用。任务分配时根据类型选择对应 Agent。

---

## 规范目录

| 分类 | 说明 | 文件 |
|------|------|------|
| 产品与文档基准、适用范围 | 以哪份文档为准、车主端 vs 服务商端 vs 后台 | [车厘子需求文档.md](车厘子需求文档.md)、[车厘子-全流程需求梳理.md](车厘子-全流程需求梳理.md) |
| 评价与激励体系 | 奖励金三级校准、全链路 4 阶评价、合规管控 | [评价和激励体系.md](评价和激励体系.md) |
| **评价奖励金设计方案** | 奖励金完整计算公式、运营后台架构、权限设计、落地要点 | [docs/评价奖励金体系-设计方案.md](docs/评价奖励金体系-设计方案.md) |
| **防刷管理规范** | 违规界定、事前/事中/事后管控、权重体系、后台运营（已整合至《评价和激励体系》第四章） | 见 [评价和激励体系.md](评价和激励体系.md) 第四章 |
| **协作规范与防刷规范-差距分析** | 当前项目与规范的差距、落地优先级、具体调整清单 | [docs/协作规范与防刷规范-差距分析.md](docs/协作规范与防刷规范-差距分析.md) |
| UI 规范（样式基准） | 浅色主题、设计令牌、组件模式、实现步骤 | [设计规范.md](设计规范.md) |
| 设计系统（可执行） | CSS 变量、工具类、组件类，禁止硬编码 | [styles/design-system.wxss](styles/design-system.wxss) |
| 小程序端规范 | 日志、交互、API、格式化、错误、跳转、缓存、模块化、订单状态规则 | [规范/小程序端规范](规范/小程序端规范.md) |
| 文档同步 | 变更必更文档、提交前检查清单、定期校验 | [规范/文档同步](规范/文档同步.md) |
| 文档校验记录 | 定期校验结果（每季度/大版本） | [docs/文档校验记录](docs/文档校验记录.md) |
| **页面功能说明** | 各页面功能、参数、交互逻辑、依赖接口（车主端、服务商端、后台运维） | [docs/pages/00-页面索引](docs/pages/00-页面索引.md) |
| **竞价流程与状态流转** | 竞价创建→报价→选厂/结束的完整流程、状态定义、工作台与列表一致性 | [docs/竞价流程与状态流转](docs/竞价流程与状态流转.md) |
| **数据库设计** | 表结构、字段、索引、ER 关系、业务规则 | [docs/database/数据库设计文档](docs/database/数据库设计文档.md) |
| **E2E 测试经验** | 网页端与小程序端 E2E 测试运行、排错、经验 | [docs/E2E测试经验](docs/E2E测试经验.md) |
| **AI Agent 分岗** | 各岗位提示词、文档归属、使用方式 | [docs/agents/00-Agent体系总览](docs/agents/00-Agent体系总览.md) |
| **规范索引** | 关键词 → 文档速查 | [docs/规范索引.md](docs/规范索引.md) |

引用本协作规范时，可根据上表找到对应规范文件，再在该文件中搜索具体条款。**按关键词检索**可查 [docs/规范索引.md](docs/规范索引.md)。

### 页面功能说明文档索引

开发或修改页面时，可先查看 [docs/pages/00-页面索引.md](docs/pages/00-页面索引.md) 获取各页面对应的功能说明文档。**车主端、汽修服务商端、后台运维**三端均有独立单页文档（功能、参数、交互、接口），格式一致。

**车主端**（01-17）：
- **01-首页**：主入口、AI 定损入口、搜索、附近/优质维修厂
- **02-AI 定损页**：照片上传、AI 分析、发起竞价
- **03-竞价报价页**：报价列表、保险/自费排序、选择维修厂
- **04-维修厂详情页**：维修厂信息、偏差率、评价、电话/导航/预约
- **04a-预约页**：维修厂详情「立即预约」入口，选择时间/项目、提交预约
- **05-主评价页**：确认完工后全屏弹出（是否需等分账完成由后台配置），1 屏 3 模块（报价/维修过程/完工验收），1 次提交
- **06-个人中心页**：用户信息、钱包、订单、竞价、收藏、设置入口
- **07-订单详情页**：订单状态、取消/确认完成/去评价
- **08-我的订单列表页**：订单列表、状态筛选
- **09-我的竞价列表页**：竞价列表、进行中/已结束
- **10-维修厂搜索列表页**：关键词搜索、分类筛选、排序
- **11-登录授权页**：微信登录、用户信息/手机号授权
- **12-消息页**：系统/竞价/订单/评价消息
- **13-设置页**：账号设置、服务商入口、关于/客服
- **14-奖励金余额明细页**：奖励金余额、明细、提现
- **15-追评弹窗**：1 个月/3 个月以弹窗形式推送（非独立页面），返厂评价等同于此，给车主足够时间发现问题
- **17-服务商注册登录页**：维修厂/服务商注册、登录入口

**汽修服务商端**（M01-M08）、**后台运维**（A01-A09）：详见《车厘子-全流程需求梳理.md》第三节、第四节及 docs/pages/00-页面索引.md

### 页面开发顺序

逐页开发时按以下顺序进行，每页完成后等待确认再进入下一页：

| 顺序 | 页面 | 说明 |
|------|------|------|
| 1 | 首页 | 主入口，AI 定损、搜索、附近/优质维修厂 |
| 2 | 维修厂搜索列表页 | 搜索、快捷入口跳转目标 |
| 3 | 维修厂详情页 | 点击维修厂卡片跳转目标 |
| 4 | 预约页 | 维修厂详情「立即预约」入口，选择时间/项目、提交预约 |
| 5 | AI 定损页 | 核心流程 |
| 6 | **登录授权页** | 需登录功能前置，定损/预约等测试前需先行 |
| 7 | **个人中心页** | TabBar，用户信息、钱包、订单入口 |
| 8 | 竞价报价页 | 定损后流程 |
| 9 | 订单详情页 | 选厂后流程 |
| 10 | 我的订单列表页 | 个人中心入口 |
| 11 | 我的竞价列表页 | 个人中心入口 |
| 12 | 评价页 | 订单完成后 |
| 13 | 消息页 | TabBar |
| 14 | 设置页 | 个人中心入口 |
| 15 | 奖励金余额明细页 | 钱包入口 |
| 16 | 追评弹窗 | 1 个月/3 个月弹窗推送，含返厂评价 |
| 17 | 服务商注册登录页 | 设置入口 |
| — | **服务商端（阶段二）** | 见《车厘子-全流程需求梳理.md》5.2 节 |
| — | **后台运维（阶段三）** | 见《车厘子-全流程需求梳理.md》5.3 节 |

### 数据库设计文档

开发或修改数据库、API 数据模型时，以 [docs/database/数据库设计文档.md](docs/database/数据库设计文档.md) 为准：

- **表结构**：19 张表（含评价体系新增：repair_complexity_levels、reward_rules、review_dimensions、review_audit_logs、complexity_upgrade_requests），详见《数据库设计文档》
- **Schema 文件**：`web/database/schema.sql`
- **变更原则**：表/字段/索引变化需同步更新设计文档和 schema.sql

### 变更记录（评价和激励体系落地）

评价体系迁移的待修改/新增页面清单、修改顺序、数据库与接口说明，已拆分至独立文档：[docs/变更记录-评价体系落地.md](docs/变更记录-评价体系落地.md)。
