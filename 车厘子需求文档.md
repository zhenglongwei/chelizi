
事故车维修平台
微信小程序产品需求文档
版本：v2.0
日期：2026年2月
基于阿里云服务，支持AI竞价维修、智能定损、前后对比分析
 
目  录
（提示：首次打开请右键点击目录，选择“更新域”刷新页码）
1 产品概述	1
1.1 产品定位	1
1.2 核心功能	1
1.3 商业模式	1
1.3.1 佣金收取	1
1.3.2 返点分配	1
1.3.3 返点获取条件	1
1.4 技术架构	1
1.4.1 技术栈	1
1.4.2 云开发优势	1
2 页面功能说明	1
2.1 首页	1
2.1.1 页面路径	1
2.1.2 页面布局	1
2.1.3 功能点详细说明	1
功能点1：AI定损入口	1
2.2 AI定损页	1
2.2.1 页面路径	1
2.2.2 页面布局	1
2.2.3 功能点详细说明	1
功能点1：照片上传	1
功能点2：AI定损分析	1
功能点3：发起竞价	1
2.2.4 接口说明	1
2.3 竞价报价页	1
2.3.1 页面路径	1
2.3.2 页面布局	1
2.3.3 功能点详细说明	1
功能点1：报价排序（保险支付）	1
功能点2：报价排序（自费）	1
功能点3：选择维修厂	1
2.3.4 接口说明	1
2.4 维修厂详情页	1
2.4.1 页面路径	1
2.4.2 页面布局	1
2.4.3 功能点详细说明	1
功能点1：历史偏差率展示	1
2.5 评价页	1
2.5.1 页面路径	1
2.5.2 页面布局	1
2.5.3 功能点详细说明	1
功能点1：上传维修后照片	1
功能点2：AI前后对比分析	1
功能点3：返点计算展示	1
2.5.4 接口说明	1
2.6 个人中心页	1
2.6.1 页面路径	1
2.6.2 页面布局	1
2.6.3 功能点详细说明	1
功能点1：返点提现	1
2.6.4 接口说明	1
3 AI功能设计	1
3.1 AI定损分析	1
3.1.1 技术方案	1
3.1.2 分析流程	1
3.1.3 输出报告格式	1
3.2 维修前后对比分析	1
3.2.1 技术可行性分析	1
3.2.2 实际意义	1
3.2.3 局限性	1
3.2.4 分析指标	1
4 竞价维修机制	1
4.1 报价流程	1
4.2 报价排序规则	1
4.2.1 保险支付场景	1
4.2.2 自费场景	1
4.3 报价偏差惩罚机制	1
4.3.1 偏差计算	1
4.3.2 惩罚规则	1
4.3.3 惩罚影响	1
4.3.4 偏差豁免	1
5 验证标准与测试用例	1
5.1 功能测试用例	1
5.1.1 AI定损页测试用例	1
5.1.2 竞价报价页测试用例	1
5.1.3 评价页测试用例	1
5.2 性能测试标准	1
5.3 AI功能测试标准	1
6 数据模型设计	1
6.1 用户数据模型	1
6.2 维修厂数据模型	1
6.3 竞价数据模型	1
6.4 报价数据模型	1
6.5 订单数据模型	1
6.6 评价数据模型	1
7 接口设计	1
7.1 用户相关接口	1
7.2 定损相关接口	1
7.3 竞价相关接口	1
7.4 维修厂相关接口	1
7.5 评价相关接口	1
7.6 云函数列表	1
7.7 通用响应格式	1
7.8 错误码定义	1
8 汽修服务商端（小程序内）	1
8.1 概述	1
8.2 页面与功能索引	1
8.3 服务商端依赖接口	1
9 后台运维（Web 管理）	1
9.1 概述	1
9.2 页面与功能索引	1
9.3 后台依赖接口	1

 
1 产品概述
1.1 产品定位
事故车维修平台是一款基于微信小程序和阿里云服务的轻量级应用，定位为“事故车维修领域的智能竞价平台”。平台通过AI技术分析事故车损伤情况，连接车主与多家维修厂进行竞价报价，帮助车主获得最优维修方案。
平台核心创新点：
• AI智能定损：用户上传事故照片，AI自动分析损伤情况并生成损失报告
• 竞价维修：多家维修厂基于AI报告进行报价，车主自主选择
• 前后对比：维修前后照片AI对比分析，验证维修质量
• 返点激励：维修完成后用户可获得最高10%返点
1.2 核心功能
• AI定损分析：基于图像识别技术分析事故损伤，生成专业损失报告
• 竞价报价：多家维修厂参与报价，智能排序推荐
• 维修厂搜索：支持按地理位置、车型、维修项目等维度筛选
• 评价体系：基于真实交易的评价，包含维修质量、价格透明度、服务态度等多维度评分
• 前后对比：维修前后照片AI对比分析
• 返点机制：维修完成后最高可获得10%返点
1.3 商业模式
平台采用“佣金+返点”的商业模式：
1.3.1 佣金收取
向维修厂收取维修金额的12%作为佣金。佣金在维修完成后结算。
1.3.2 返点分配
用户可获得最高10%的返点，分阶段发放：
评价类型	返点比例	获取条件
首次评价	8%	维修完成后7天内提交评价
追评	2%	首次评价后6个月内，车辆未返厂
返厂评价	2%	首次评价后6个月内返厂，上传返厂照片
合计	最高10%	-
1.3.3 返点获取条件
• 首次评价返点（8%）：维修完成后7天内提交首次评价即可获得
• 追评返点（2%）：首次评价后6个月内，若车辆未返厂维修，提交追评可获得
• 返厂快速返点（2%）：首次评价后6个月内，若车辆返厂维修，上传返厂照片即可获得2%返点，无需等待半年
1.4 技术架构
平台基于阿里云ECS + MySQL + OSS构建，提供稳定可靠的云服务。
1.4.1 技术栈
• 前端：微信小程序原生框架
• 后端：Node.js + Express + MySQL (阿里云ECS)
• 文件存储：阿里云OSS
• AI服务：阿里云百炼/通义千问图像识别 + 自研定损模型
• 地图：腾讯位置服务

2 页面功能说明
2.1 首页
2.1.1 页面路径
/pages/index/index
2.1.2 页面布局
模块	说明
顶部导航栏	小程序原生导航栏，显示页面标题“事故车维修平台”
AI定损入口	大按钮：“上传事故照片，获取AI定损报告”
搜索栏	搜索框，placeholder为“搜索维修厂、车型、维修项目”
轮播图	3-5张轮播图，展示平台活动、优质维修厂推荐等
快捷入口	4个图标入口：钣金喷漆、发动机维修、电路维修、保养服务
附近维修厂	基于用户地理位置，展示附近5公里内的维修厂列表
优质推荐	平台认证的高评分维修厂推荐
底部TabBar	首页、定损、消息、我的
2.1.3 功能点详细说明
功能点1：AI定损入口
功能ID	F-INDEX-001
功能描述	点击AI定损入口，进入定损页面
操作流程	1. 用户点击“上传事故照片”大按钮 2. 跳转到AI定损页 /pages/damage/upload
预期结果	1. 点击按钮，跳转到定损页 2. 定损页显示照片上传区域
备注	1. 首次使用显示功能引导 2. 记录用户点击行为，用于数据分析
2.2 AI定损页
2.2.1 页面路径
/pages/damage/upload
2.2.2 页面布局
模块	说明
照片上传区	支持上传4-8张事故照片（车身45度角、损伤特写、车架号等）
拍摄引导	提供拍摄示例图和文字说明
车辆信息	车牌号、车型、行驶里程等
	
AI分析按钮	上传完成后点击开始AI分析
分析进度	显示AI分析进度条
2.2.3 功能点详细说明
功能点1：照片上传
功能ID	F-DAMAGE-001
功能描述	用户上传事故车照片
操作流程	1. 用户点击上传区域 2. 选择拍照或从相册选择 3. 图片压缩（最大5MB） 4. 上传到阿里云OSS 5. 显示上传进度和缩略图
预期结果	1. 支持最多上传8张照片 2. 显示拍摄示例图 3. 上传完成后显示缩略图 4. 支持删除和重新上传
备注	1. 必填照片：车身45度角、损伤特写、车架号 2. 单张图片不超过5MB 3. 图片自动压缩到1080p
功能点2：AI定损分析
功能ID	F-DAMAGE-002
功能描述	调用AI分析事故照片，生成损失报告
操作流程	1. 用户点击“开始AI分析” 2. 调用后端API /api/v1/damage/analyze 3. 后端调用阿里云AI图像识别服务 4. AI分析损伤部位、损伤程度 5. 生成损失报告 6. 显示分析结果
预期结果	1. 显示分析进度（0-100%） 2. 分析完成后显示损失报告 3. 报告包含：损伤部位、预估维修项目、参考价格区间
备注	1. 分析时间约10-30秒 2. 分析失败时提示用户重新上传 3. 报告仅供参考，实际以维修厂报价为准
功能点3：发起竞价
功能ID	F-DAMAGE-003
功能描述	基于AI报告发起竞价，邀请维修厂报价
操作流程	1. 用户确认AI报告（报告内容可编辑） 2. 选择竞价范围（附近5km/10km/全市）、是否走保险理赔。如果是 ，选择单方事故（自己幢固定物，不涉及其他车辆，由己方保险公司赔付）、己方全责（己方保险公司赔付）、对方全责（对方保险公司赔付）、多方事故主次责（通常由主责方保险公司定损，可能双方协商），根据事故类型选择己方或对方的保险公司，或双方的保险公司。3. 点击“发起竞价” 4. 系统向符合条件的维修厂推送竞价邀请 5. 跳转到竞价报价页
预期结果	1. 显示竞价范围选择 2. 发起竞价后跳转到报价页 3. 报价页实时显示已报价商家
备注	1. 竞价有效期24小时 2. 至少邀请5家维修厂 3. 用户可随时结束竞价
2.2.4 接口说明
方法	接口	说明	参数
POST	/api/v1/damage/analyze	AI定损分析	images, vehicle_info
POST	/api/v1/damage/report	获取定损报告	report_id
POST	/api/v1/bidding/create	发起竞价	report_id, range, insurance_info
2.3 竞价报价页
2.3.1 页面路径
/pages/bidding/detail
2.3.2 页面布局
模块	说明
竞价状态	显示竞价倒计时、已报价数量
AI定损报告	可展开查看AI分析结果
报价列表	维修厂报价列表，按规则排序
报价卡片	维修厂信息、报价金额、预计工期、质保期限
排序切换	保险支付/自费切换，重新排序
选择按钮	选择某家维修厂
2.3.3 功能点详细说明
功能点1：报价排序（保险支付）
功能ID	F-BIDDING-001
功能描述	保险支付场景下，报价按综合评分排序，优先展示高报价
操作流程	1. 用户选择“保险支付” 2. 系统按综合评分排序 3. 排序公式：综合评分 = 报价金额标准化处理后的结果*0.4 + 维修厂评分*0.3 + 历史偏差率*0.2 + 响应速度*0.1 4. 高报价商家排名靠前（佣金更高）
预期结果	1. 报价列表按综合评分排序 2. 高报价商家排名靠前 3. 显示综合评分和各项子分数
备注	1. 保险支付时，平台佣金来自保险公司 2. 高报价对应高佣金，激励维修厂提供优质服务
功能点2：报价排序（自费）
功能ID	F-BIDDING-002
功能描述	自费场景下，报价按价格从低到高排序
操作流程	1. 用户选择“自费” 2. 系统按报价金额从低到高排序 3. 同价格按维修厂评分排序
预期结果	1. 报价列表按价格升序排列 2. 价格相同则评分高的靠前 3. 显示“省XX元”对比最高价
备注	1. 自费场景下，用户更关注价格 2. 低价优先帮助用户节省费用
功能点3：选择维修厂
功能ID	F-BIDDING-003
功能描述	用户选择某家维修厂，确认维修
操作流程	1. 用户点击“选择”按钮 2. 弹出确认框，显示报价详情 3. 用户确认后，生成维修订单 4. 通知维修厂接单 5. 跳转到订单详情页
预期结果	1. 点击选择，弹出确认框 2. 确认后生成订单 3. 显示订单详情和维修厂联系方式
备注	1. 选择后竞价结束 2. 24小时内可取消订单 3. 取消后重新发起竞价
2.3.4 接口说明
方法	接口	说明	参数
GET	/api/v1/bidding/{id}	获取竞价详情	bidding_id
GET	/api/v1/bidding/{id}/quotes	获取报价列表	bidding_id, sort_type
POST	/api/v1/bidding/{id}/select	选择维修厂	bidding_id, shop_id
2.4 维修厂详情页
2.4.1 页面路径
/pages/shop/detail
2.4.2 页面布局
模块	说明
维修厂信息区	维修厂名称、评分、地址、营业时间、联系电话
资质认证区	营业执照、行业认证、保险合作等资质展示
历史偏差率	报价偏差率指标，反映报价准确度
服务项目区	维修厂提供的服务项目列表及参考价格
评价汇总区	综合评分、各维度评分、评价数量
评价列表区	用户评价列表，支持筛选
底部操作栏	电话咨询、导航到店、立即预约
2.4.3 功能点详细说明
功能点1：历史偏差率展示
功能ID	F-SHOP-DETAIL-001
功能描述	展示维修厂的历史报价偏差率
操作流程	1. 计算维修厂所有订单的报价偏差率 2. 偏差率 = |实际金额 - 报价金额| / 报价金额 * 100% 3. 显示平均偏差率和偏差率趋势
预期结果	1. 显示“报价准确度：95%” 2. 偏差率低于10%显示绿色 3. 偏差率10-20%显示黄色 4. 偏差率高于20%显示红色
备注	1. 偏差率影响维修厂综合评分 2. 高偏差率会降低报价排序权重
2.5 评价页
2.5.1 页面路径
/pages/review/submit
2.5.2 页面布局
模块	说明
维修厂信息	显示待评价的维修厂名称和维修项目
维修前照片	显示用户上传的维修前照片
维修后照片	上传维修后照片（必填）
AI对比分析	AI对比维修前后照片，分析维修质量
星级评分	综合评分（1-5星）
分项评分	维修质量、价格透明、服务态度、维修速度、配件质量
评价内容	文本输入框，支持多行输入
匿名选项	是否匿名评价
返点提示	显示可获得返点金额
提交按钮	提交评价
2.5.3 功能点详细说明
功能点1：上传维修后照片
功能ID	F-REVIEW-001
功能描述	用户上传维修后照片，用于AI对比分析
操作流程	1. 用户点击上传区域 2. 选择拍照或从相册选择 3. 上传维修后照片 4. 照片需与维修前照片角度一致
预期结果	1. 显示维修前照片作为参考 2. 上传后显示缩略图 3. 提示用户保持相同拍摄角度
备注	1. 维修后照片为必填项 2. 至少上传3张（车身45度角、损伤修复部位、车架号）
功能点2：AI前后对比分析
功能ID	F-REVIEW-002
功能描述	AI对比维修前后照片，分析维修质量
操作流程	1. 用户上传维修后照片 2. 调用后端API /api/v1/reviews/analyze 3. AI对比前后照片 4. 分析损伤修复情况、漆面质量等 5. 生成维修质量评分
预期结果	1. 显示AI分析进度 2. 分析完成后显示质量评分 3. 标记修复完成部位 4. 提示可能存在的问题
备注	1. AI分析时间约5-10秒 2. 分析结果仅供参考 3. 低质量评分需要人工复核
功能点3：返点计算展示
功能ID	F-REVIEW-003
功能描述	根据评价类型计算并展示返点金额
操作流程	1. 首次评价：返点 = 维修金额 * 8% 2. 追评/返厂评价：返点 = 维修金额 * 2% 3. 显示当前可获得返点和累计可获得返点
预期结果	1. 首次评价显示“可获得返点：XXX元（8%）” 2. 提交后显示“返点已到账” 3. 提示用户6个月内可追评获得额外2%
备注	1. 返点发放到用户余额 2. 满10元可申请提现 3. 返点不可叠加超过10%
2.5.4 接口说明
方法	接口	说明	参数
POST	/api/v1/reviews	提交评价	order_id, rating, content, before_images, after_images, is_anonymous
POST	/api/v1/reviews/analyze	AI对比分析	before_images, after_images
POST	/api/v1/reviews/followup	提交追评	review_id, content, images
POST	/api/v1/reviews/return	返厂评价	order_id, images, content
2.6 个人中心页
2.6.1 页面路径
/pages/user/index
2.6.2 页面布局
模块	说明
用户信息区	头像、昵称、会员等级
我的钱包	返点余额、累计返点、提现按钮
我的订单	全部订单、待评价、已完成
我的竞价	进行中、已结束
我的收藏	收藏的维修厂
浏览历史	最近浏览的维修厂
设置	账号设置、关于我们、联系客服（在账号设置下添加服务商注册、登陆入口）
	
2.6.3 功能点详细说明
功能点1：返点提现
功能ID	F-USER-001
功能描述	用户申请提现返点余额
操作流程	1. 用户点击提现按钮 2. 输入提现金额（最低10元） 3. 选择提现方式（微信零钱） 4. 确认提现 5. 调用后端API /api/v1/user/withdraw 6. 提交提现申请
预期结果	1. 显示可提现余额 2. 输入金额后显示预计到账时间 3. 确认后显示“提现申请已提交” 4. 1-3个工作日到账
备注	1. 最低提现金额10元 2. 单日最高提现5000元 3. 记录提现历史
2.6.4 接口说明
方法	接口	说明	参数
POST	/api/v1/user/withdraw	申请提现	amount
GET	/api/v1/user/balance	获取余额明细	page, limit
GET	/api/v1/user/orders	获取用户订单	status, page, limit
GET	/api/v1/user/biddings	获取用户竞价	status, page, limit
3 AI功能设计
3.1 AI定损分析
AI定损分析是平台的核心功能，通过图像识别技术分析事故车损伤情况，生成专业损失报告。
3.1.1 技术方案
• 图像识别：使用腾讯云AI图像识别服务，识别车辆损伤部位
• 损伤分类：基于深度学习模型，分类损伤类型（划痕、凹陷、破裂、变形等）
• 损伤程度评估：评估损伤严重程度（轻微、中等、严重）
• 维修项目推荐：根据损伤情况推荐维修项目和参考价格
3.1.2 分析流程
1. 图片预处理
   - 图片压缩和格式转换
   - 去除水印和干扰元素
   - 图像增强（亮度、对比度调整）

2. 损伤检测
   - 识别车辆部位（前保险杠、后保险杠、车门、引擎盖等）
   - 检测损伤区域
   - 标记损伤位置和范围

3. 损伤分类
   - 分类损伤类型：划痕/凹陷/破裂/变形/断裂
   - 评估损伤程度：轻微/中等/严重

4. 生成报告
   - 汇总损伤部位和类型
   - 推荐维修项目
   - 估算参考价格区间
3.1.3 输出报告格式
{
  "report_id": "string",
  "vehicle_info": {
    "plate_number": "string",
    "model": "string"
  },
  "damages": [
    {
      "part": "前保险杠",
      "type": "凹陷",
      "severity": "中等",
      "area": "15x20cm",
      "confidence": 0.92
    }
  ],
  "repair_suggestions": [
    {
      "item": "钣金修复",
      "price_range": [800, 1200]
    }
  ],
  "total_estimate": [2000, 3500],
  "confidence_score": 0.88
}
3.2 维修前后对比分析
维修前后对比分析是评价环节的重要功能，通过AI对比维修前后照片，客观评估维修质量。
3.2.1 技术可行性分析
AI对比分析具有以下技术可行性：
• 损伤修复检测：AI可以识别原损伤部位是否已修复
• 漆面质量评估：分析漆面平整度、色差、光泽度
• 装配精度检测：检测缝隙均匀性、部件对齐度
• 异物检测：检测是否有残留异物、漆面瑕疵
3.2.2 实际意义
AI对比分析的实际意义：
• 客观评价：减少主观评价偏差，提供客观质量指标
• 问题发现：自动发现肉眼难以察觉的维修缺陷
• 纠纷调解：为维修质量纠纷提供客观依据
• 维修厂监督：激励维修厂提高维修质量
3.2.3 局限性
AI对比分析也存在一定局限性：
• 光线影响：不同光线条件下拍摄的照片可能影响分析准确性
• 角度要求：需要相同角度拍摄的照片进行对比
• 复杂损伤：复杂结构性损伤的修复质量难以完全通过图像判断
• 参考性质：AI分析结果仅供参考，最终质量判断仍需人工确认
3.2.4 分析指标
分析指标	说明	评分标准
损伤修复率	原损伤部位是否完全修复	100%修复得满分
漆面质量	漆面平整度、色差、光泽度	无瑕疵得满分
装配精度	缝隙均匀性、部件对齐度	符合原厂标准得满分
异物残留	是否有残留异物、漆面瑕疵	无残留得满分
综合质量分	综合以上指标	0-100分
4 竞价维修机制
4.1 报价流程
1. 用户发起竞价
   - 上传事故照片
   - AI生成定损报告
   - 选择竞价范围
   - 发起竞价

2. 维修厂报价
   - 系统推送竞价邀请给符合条件的维修厂
   - 维修厂查看AI定损报告
   - 维修厂提交报价（含维修项目、工期、质保）
   - 报价有效期24小时

3. 用户选择
   - 查看所有报价
   - 对比维修厂评分、报价、工期
   - 选择维修厂
   - 生成维修订单

4. 维修完成
   - 维修厂完成维修
   - 用户确认维修完成
   - 用户上传维修后照片
   - 提交评价，获得返点
4.2 报价排序规则
4.2.1 保险支付场景
保险支付时，报价按综合评分排序，优先展示高报价：
综合评分 = 报价金额（标准化处理） * 0.4 + 维修厂评分 * 0.3 + 历史偏差率 * 0.2 + 响应速度 * 0.1

其中：
- 报价金额：报价越高得分越高（归一化处理）
- 维修厂评分：平台评分（0-5分）
- 历史偏差率：1 - 平均偏差率（偏差率越低得分越高）
- 响应速度：报价提交时间越早得分越高
保险支付场景下优先展示高报价的原因：
• 佣金来源：保险支付时平台佣金来自保险公司，与用户支付金额无关
• 服务激励：高报价通常对应更好的服务质量和配件品质
• 维修厂激励：鼓励维修厂提供优质服务和真实报价
4.2.2 自费场景
自费时，报价按价格从低到高排序：
排序规则：
1. 按报价金额升序排列
2. 报价相同则按维修厂评分降序排列
3. 显示“比最高价省XX元”
自费场景下优先展示低价的原因：
• 用户利益：自费用户更关注价格，低价优先帮助用户节省费用
• 市场竞争：促使维修厂提供有竞争力的价格
• 透明比价：让用户清楚了解市场价格区间
4.3 报价偏差惩罚机制
4.3.1 偏差计算
偏差率 = |实际维修金额 - 报价金额| / 报价金额 * 100%

示例：
- 报价：5000元
- 实际：6500元
- 偏差率 = |6500 - 5000| / 5000 * 100% = 30%
4.3.2 惩罚规则
偏差率范围	惩罚措施	影响
< 10%	无惩罚	偏差率低，提升排序权重
10% - 20%	警告	记录偏差，不影响排序
20% - 30%	扣分	综合评分-5分，降低排序权重
30% - 50%	严重警告	综合评分-10分，暂停竞价3天
> 50%	严重违规	综合评分-20分，暂停竞价7天，扣除保证金
4.3.3 惩罚影响
• 综合评分降低：偏差率影响维修厂综合评分，降低报价排序权重
• 竞价资格限制：连续3次偏差率>30%，暂停竞价资格7天
• 保证金扣除：严重偏差（>50%）扣除部分保证金
• 公开警示：高偏差率维修厂在详情页显示警示标识
4.3.4 偏差豁免
以下情况可申请偏差豁免：
• 新增损伤：维修过程中发现新的隐性损伤
• 用户要求：用户主动要求增加维修项目
• 配件变更：因配件缺货更换为其他品牌/型号
• 保险定损差异：保险公司定损金额与维修厂报价差异
5 验证标准与测试用例
5.1 功能测试用例
5.1.1 AI定损页测试用例
用例ID	用例名称	操作步骤	预期结果	状态	优先级
TC-DAMAGE-001	照片上传-正常流程	1. 点击上传 2. 选择照片 3. 上传完成	显示上传进度，完成后显示缩略图	通过	高
TC-DAMAGE-002	照片上传-超出数量限制	上传9张照片	提示“最多上传8张”	通过	中
TC-DAMAGE-003	照片上传-文件过大	上传6MB照片	自动压缩后上传	通过	中
TC-DAMAGE-004	AI分析-正常流程	1. 上传照片 2. 点击分析	显示进度条，完成后显示报告	通过	高
TC-DAMAGE-005	AI分析-分析失败	上传模糊照片	提示“照片不清晰，请重新上传”	通过	高
TC-DAMAGE-006	发起竞价-正常流程	1. 确认报告 2. 选择范围 3. 发起竞价	跳转到报价页，显示竞价中	通过	高
5.1.2 竞价报价页测试用例
用例ID	用例名称	操作步骤	预期结果	状态	优先级
TC-BIDDING-001	报价排序-保险支付	选择“保险支付”	高报价商家排名靠前	通过	高
TC-BIDDING-002	报价排序-自费	选择“自费”	报价按价格升序排列	通过	高
TC-BIDDING-003	选择维修厂-正常流程	1. 点击选择 2. 确认	生成订单，跳转到订单页	通过	高
TC-BIDDING-004	竞价倒计时	等待竞价倒计时	倒计时结束自动结束竞价	通过	中
TC-BIDDING-005	实时报价更新	维修厂提交新报价	列表实时显示新报价	通过	中
5.1.3 评价页测试用例
用例ID	用例名称	操作步骤	预期结果	状态	优先级
TC-REVIEW-001	上传维修后照片	上传维修后照片	显示缩略图，AI分析按钮可用	通过	高
TC-REVIEW-002	AI对比分析	1. 上传照片 2. 点击分析	显示AI分析结果和质量评分	通过	高
TC-REVIEW-003	首次评价返点	提交首次评价	显示返点金额（8%）	通过	高
TC-REVIEW-004	追评返点	6个月后提交追评	显示返点金额（2%）	通过	高
TC-REVIEW-005	返厂返点	上传返厂照片	显示返点金额（2%）	通过	高
TC-REVIEW-006	返点上限	首次评价+追评	累计返点不超过10%	通过	高
5.2 性能测试标准
指标	标准	说明
页面加载时间	< 2秒	从点击到页面渲染完成
接口响应时间	< 500ms	API接口平均响应时间
AI分析时间	< 30秒	定损分析完成时间
图片上传时间	< 5秒	单张图片上传完成时间
列表滚动流畅度	> 50fps	列表滚动时帧率
内存占用	< 100MB	小程序运行时内存占用
包大小	< 2MB	小程序代码包大小
5.3 AI功能测试标准
指标	标准	说明
损伤识别准确率	> 85%	正确识别损伤部位和类型
损伤程度评估准确率	> 80%	正确评估损伤严重程度
价格估算偏差	< 30%	AI估算价格与实际价格偏差
前后对比准确率	> 80%	正确判断损伤修复情况
分析成功率	> 95%	成功完成分析的比例
6 数据模型设计
6.1 用户数据模型
{
  "_id": "string",               // 云数据库ID
  "user_id": "string",          // 用户ID
  "openid": "string",           // 微信openid
  "unionid": "string",          // 微信unionid
  "nickname": "string",         // 用户昵称
  "avatar_url": "string",       // 头像URL
  "phone": "string",            // 手机号
  "level": "integer",           // 用户等级 1-8
  "points": "integer",          // 积分
  "balance": "decimal",         // 返点余额
  "total_rebate": "decimal",    // 累计返点
  "total_reviews": "integer",   // 评价总数
  "location": {                   // 用户位置
    "province": "string",
    "city": "string",
    "district": "string",
    "latitude": "decimal",
    "longitude": "decimal"
  },
  "created_at": "datetime",     // 创建时间
  "updated_at": "datetime"      // 更新时间
}
6.2 维修厂数据模型
{
  "_id": "string",
  "shop_id": "string",           // 维修厂ID
  "name": "string",              // 维修厂名称
  "logo": "string",              // Logo URL
  "address": "string",           // 详细地址
  "province": "string",          // 省份
  "city": "string",              // 城市
  "district": "string",          // 区县
  "latitude": "decimal",        // 纬度
  "longitude": "decimal",       // 经度
  "phone": "string",             // 联系电话
  "business_hours": "string",   // 营业时间
  "categories": ["string"],      // 服务分类
  "rating": "decimal",           // 综合评分 0-5
  "rating_count": "integer",    // 评价数量
  "deviation_rate": "decimal",  // 平均报价偏差率
  "total_orders": "integer",    // 总订单数
  "is_certified": "boolean",    // 是否认证
  "certifications": [              // 资质认证
    {
      "type": "string",
      "name": "string",
      "image": "string"
    }
  ],
  "services": [                     // 服务项目
    {
      "name": "string",
      "min_price": "decimal",
      "max_price": "decimal"
    }
  ],
  "status": "integer",            // 状态 0-禁用 1-启用
  "created_at": "datetime",
  "updated_at": "datetime"
}
6.3 竞价数据模型
{
  "_id": "string",
  "bidding_id": "string",         // 竞价ID
  "user_id": "string",            // 用户ID
  "report_id": "string",          // 定损报告ID
  "vehicle_info": {                 // 车辆信息
    "plate_number": "string",
    "model": "string",
    "mileage": "integer"
  },
  "insurance_info": {               // 保险信息
    "company": "string",
    "is_insurance": "boolean"
  },
  "range": "integer",              // 竞价范围（km）
  "status": "integer",            // 状态 0-进行中 1-已结束 2-已取消
  "expire_at": "datetime",       // 过期时间
  "selected_shop_id": "string",  // 选中的维修厂ID
  "created_at": "datetime",
  "updated_at": "datetime"
}
6.4 报价数据模型
{
  "_id": "string",
  "quote_id": "string",           // 报价ID
  "bidding_id": "string",         // 竞价ID
  "shop_id": "string",            // 维修厂ID
  "amount": "decimal",            // 报价金额
  "items": [                        // 维修项目
    {
      "name": "string",
      "price": "decimal"
    }
  ],
  "duration": "integer",           // 预计工期（天）
  "warranty": "integer",           // 质保期限（月）
  "remark": "string",              // 备注
  "created_at": "datetime",
  "updated_at": "datetime"
}
6.5 订单数据模型
{
  "_id": "string",
  "order_id": "string",           // 订单ID
  "bidding_id": "string",         // 竞价ID
  "user_id": "string",            // 用户ID
  "shop_id": "string",            // 维修厂ID
  "quote_id": "string",           // 报价ID
  "quoted_amount": "decimal",     // 报价金额
  "actual_amount": "decimal",     // 实际金额
  "deviation_rate": "decimal",    // 偏差率
  "commission_rate": "decimal",   // 佣金比例（12%）
  "commission": "decimal",        // 佣金金额
  "status": "integer",            // 状态
  "created_at": "datetime",
  "updated_at": "datetime",
  "completed_at": "datetime"      // 完成时间
}
6.6 评价数据模型
{
  "_id": "string",
  "review_id": "string",          // 评价ID
  "order_id": "string",           // 订单ID
  "shop_id": "string",            // 维修厂ID
  "user_id": "string",            // 用户ID
  "type": "integer",              // 评价类型 1-首次评价 2-追评 3-返厂评价
  "rating": "integer",             // 综合评分 1-5
  "ratings": {                      // 分项评分
    "quality": "integer",
    "price": "integer",
    "service": "integer",
    "speed": "integer",
    "parts": "integer"
  },
  "content": "string",             // 评价内容
  "before_images": ["string"],     // 维修前照片
  "after_images": ["string"],      // 维修后照片
  "ai_analysis": {                  // AI分析结果
    "quality_score": "decimal",
    "repair_areas": ["string"],
    "issues": ["string"]
  },
  "is_anonymous": "boolean",       // 是否匿名
  "like_count": "integer",         // 点赞数
  "rebate_amount": "decimal",     // 返点金额
  "rebate_rate": "decimal",       // 返点比例
  "status": "integer",             // 状态
  "created_at": "datetime",
  "updated_at": "datetime"
}
7 接口设计
7.1 用户相关接口
方法	接口	说明	请求参数	响应数据	错误码
POST	/api/v1/auth/login	微信登录	{code: string}	{token: string, user: object}	401-授权码无效
GET	/api/v1/user/profile	获取用户信息	-	{user: object}	401-未登录
PUT	/api/v1/user/profile	更新用户信息	{nickname: string, avatar_url: string}	{user: object}	401-未登录
POST	/api/v1/user/withdraw	申请提现	{amount: decimal}	{withdraw_id: string}	400-金额无效, 401-未登录
GET	/api/v1/user/balance	获取余额明细	page, limit	{list: [], total: number}	401-未登录
GET	/api/v1/user/orders	获取用户订单	status, page, limit	{list: [], total: number}	401-未登录
GET	/api/v1/user/biddings	获取用户竞价	status, page, limit	{list: [], total: number}	401-未登录
7.2 定损相关接口
方法	接口	说明	请求参数	响应数据	错误码
POST	/api/v1/damage/analyze	AI定损分析	{images: [], vehicle_info: {}}	{report_id: string, report: object}	400-图片无效
GET	/api/v1/damage/report/{id}	获取定损报告	report_id	{report: object}	404-报告不存在
7.3 竞价相关接口
方法	接口	说明	请求参数	响应数据	错误码
POST	/api/v1/bidding/create	发起竞价	{report_id, range, insurance_info}	{bidding_id: string}	400-参数无效
GET	/api/v1/bidding/{id}	获取竞价详情	bidding_id	{bidding: object}	404-竞价不存在
GET	/api/v1/bidding/{id}/quotes	获取报价列表	bidding_id, sort_type	{list: [], total: number}	404-竞价不存在
POST	/api/v1/bidding/{id}/select	选择维修厂	{shop_id}	{order_id: string}	400-参数无效, 404-竞价不存在
7.4 维修厂相关接口
方法	接口	说明	请求参数	响应数据	错误码
GET	/api/v1/shops/nearby	获取附近维修厂	latitude, longitude, page, limit	{list: [], total: number}	400-参数缺失
GET	/api/v1/shops/{id}	获取维修厂详情	shop_id	{shop: object}	404-维修厂不存在
GET	/api/v1/shops/{id}/reviews	获取维修厂评价	shop_id, page, limit	{list: [], total: number}	404-维修厂不存在
7.5 评价相关接口
方法	接口	说明	请求参数	响应数据	错误码
POST	/api/v1/reviews	提交评价	{order_id, rating, content, after_images}	{review_id: string, rebate: object}	400-参数无效, 401-未登录
POST	/api/v1/reviews/analyze	AI对比分析	{before_images, after_images}	{analysis: object}	400-图片无效
POST	/api/v1/reviews/{id}/followup	提交追评	{content}	{review_id: string, rebate: object}	401-未登录, 404-评价不存在
POST	/api/v1/reviews/return	返厂评价	{order_id, images, content}	{review_id: string, rebate: object}	401-未登录
POST	/api/v1/upload/image	上传图片	file	{url: string}	400-文件无效, 413-文件过大
7.6 后端API列表
API路径	功能说明	对应原云函数
POST /api/v1/auth/login	微信登录，获取openid和token	auth.login
POST /api/v1/damage/analyze	AI定损分析，调用阿里云AI服务	damage.analyze
POST /api/v1/bidding/create	创建竞价，推送邀请给维修厂	bidding.create
POST /api/v1/bidding/{id}/select	用户选择维修厂，生成订单	bidding.select
POST /api/v1/reviews	提交评价，计算返点	review.submit
POST /api/v1/reviews/analyze	AI对比分析维修前后照片	review.analyze
POST /api/v1/shop/calculateDeviation	计算维修厂报价偏差率	shop.calculateDeviation
POST /api/v1/user/withdraw	处理用户提现申请	user.withdraw
POST /api/v1/cron/closeExpiredBidding	定时任务：关闭过期竞价	cron.closeExpiredBidding
POST /api/v1/cron/calculateRebate	定时任务：计算并发放返点	cron.calculateRebate
7.7 通用响应格式
// 成功响应
{
  "code": 200,
  "message": "success",
  "data": { ... }
}

// 错误响应
{
  "code": 400,
  "message": "参数错误",
  "errors": [
    {"field": "rating", "message": "评分不能为空"}
  ]
}
7.8 错误码定义
错误码	错误信息	说明
200	success	请求成功
400	bad request	请求参数错误
401	unauthorized	未登录或token过期
403	forbidden	无权限访问
404	not found	资源不存在
413	payload too large	请求体过大
429	too many requests	请求过于频繁
500	internal server error	服务器内部错误

8 汽修服务商端（小程序内）
8.1 概述
汽修服务商功能集成在与车主端同一微信小程序内，通过「个人中心 → 设置 → 服务商注册/登录」进入。服务商可接收竞价邀请、提交报价、接单、更新订单状态、管理本店信息。
8.2 页面与功能索引
详细页面说明见 docs/pages/ 下 M01-M08 文档，索引见 docs/pages/00-页面索引.md。

| 页面 | 路径 | 功能 |
|------|------|------|
| 服务商登录 | /pages/merchant/login | 手机号+密码登录 |
| 服务商注册 | /pages/merchant/register | 企业信息、资质、提交审核 |
| 服务商工作台 | /pages/merchant/home | 待报价、待接单、维修中汇总 |
| 竞价邀请列表 | /pages/merchant/bidding/list | 邀请本店的竞价 |
| 竞价详情与报价 | /pages/merchant/bidding/detail | 查看定损报告、提交报价 |
| 服务商订单列表 | /pages/merchant/order/list | 本店订单，按状态筛选 |
| 服务商订单详情 | /pages/merchant/order/detail | 接单、更新状态（维修中→待确认） |
| 维修厂信息 | /pages/merchant/shop/profile | 查看/编辑本店信息 |

8.3 服务商端依赖接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/merchant/login | POST | 服务商登录 |
| /api/v1/merchant/register | POST | 服务商注册 |
| /api/v1/merchant/dashboard | GET | 工作台汇总 |
| /api/v1/merchant/biddings | GET | 竞价邀请列表 |
| /api/v1/merchant/bidding/:id | GET | 竞价详情 |
| /api/v1/merchant/quote | POST | 提交报价 |
| /api/v1/merchant/orders | GET | 本店订单列表 |
| /api/v1/merchant/orders/:id | GET | 订单详情 |
| /api/v1/merchant/orders/:id/accept | POST | 接单 |
| /api/v1/merchant/orders/:id/status | PUT | 更新订单状态 |
| /api/v1/merchant/shop | GET/PUT | 获取/更新本店信息 |

9 后台运维（Web 管理）
9.1 概述
后台运维为 Web 管理后台（React + Ant Design），用于平台运营人员管理维修厂、订单、配置、统计等。部署于 web/dist/，访问路径 /admin/*。样式独立于小程序，不参考《设计规范.md》。
9.2 页面与功能索引
详细页面说明见 docs/pages/ 下 A01-A09 文档，索引见 docs/pages/00-页面索引.md。

| 页面 | 路由 | 功能 |
|------|------|------|
| 后台登录 | /admin/login | 管理员账号密码 |
| 工作台 | /admin/dashboard | 数据概览 |
| 维修厂管理 | /admin/merchants | 商户列表、审核 |
| 订单管理 | /admin/orders | 订单列表、详情、报价审核 |
| 规则配置 | /admin/rules | 竞价规则、偏差、返点 |
| 结算管理 | /admin/settlement | 佣金、结算 |
| 纠纷管理 | /admin/disputes | 投诉、纠纷处理 |
| 数据统计 | /admin/statistics | 订单量、GMV、分布 |
| 系统配置 | /admin/config | AI 限制、全局参数 |

9.3 后台依赖接口
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/admin/login | POST | 管理员登录 |
| /api/v1/admin/merchants | GET | 商户列表 |
| /api/v1/admin/merchants/:id/audit | POST | 商户审核 |
| /api/v1/admin/orders | GET | 订单列表 |
| /api/v1/admin/orders/:orderNo | GET | 订单详情 |
| /api/v1/admin/orders/:orderNo/audit-quote | POST | 报价审核 |
| /api/v1/admin/statistics | GET | 数据统计 |
| /api/v1/admin/settlements | GET | 结算列表 |
| /api/v1/admin/complaints | GET/PUT | 纠纷列表/更新 |
| /api/v1/admin/config | GET/PUT | 系统配置 |

